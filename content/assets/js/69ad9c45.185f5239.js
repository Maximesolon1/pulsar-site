"use strict";(self.webpackChunkwebsite_next=self.webpackChunkwebsite_next||[]).push([[77766],{15680:(e,a,t)=>{t.d(a,{xA:()=>p,yg:()=>d});var n=t(96540);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function l(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?l(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function o(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)t=l[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)t=l[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=n.createContext({}),u=function(e){var a=n.useContext(s),t=a;return e&&(t="function"==typeof e?e(a):i(i({},a),e)),t},p=function(e){var a=u(e.components);return n.createElement(s.Provider,{value:a},e.children)},g="mdxType",c={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},m=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),g=u(t),m=r,d=g["".concat(s,".").concat(m)]||g[m]||c[m]||l;return t?n.createElement(d,i(i({ref:a},p),{},{components:t})):n.createElement(d,i({ref:a},p))}));function d(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var l=t.length,i=new Array(l);i[0]=m;var o={};for(var s in a)hasOwnProperty.call(a,s)&&(o[s]=a[s]);o.originalType=e,o[g]="string"==typeof e?e:r,i[1]=o;for(var u=2;u<l;u++)i[u]=t[u];return n.createElement.apply(null,i)}return n.createElement.apply(null,t)}m.displayName="MDXCreateElement"},19365:(e,a,t)=>{t.d(a,{A:()=>i});var n=t(96540),r=t(20053);const l={tabItem:"tabItem_Ymn6"};function i(e){let{children:a,hidden:t,className:i}=e;return n.createElement("div",{role:"tabpanel",className:(0,r.A)(l.tabItem,i),hidden:t},a)}},11470:(e,a,t)=>{t.d(a,{A:()=>C});var n=t(58168),r=t(96540),l=t(20053),i=t(23104),o=t(56347),s=t(57485),u=t(31682),p=t(89466);function g(e){return function(e){return r.Children.map(e,(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:a}=e;return!!a&&"object"==typeof a&&"value"in a}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:a,label:t,attributes:n,default:r}}=e;return{value:a,label:t,attributes:n,default:r}}))}function c(e){const{values:a,children:t}=e;return(0,r.useMemo)((()=>{const e=a??g(t);return function(e){const a=(0,u.X)(e,((e,a)=>e.value===a.value));if(a.length>0)throw new Error(`Docusaurus error: Duplicate values "${a.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[a,t])}function m(e){let{value:a,tabValues:t}=e;return t.some((e=>e.value===a))}function d(e){let{queryString:a=!1,groupId:t}=e;const n=(0,o.W6)(),l=function(e){let{queryString:a=!1,groupId:t}=e;if("string"==typeof a)return a;if(!1===a)return null;if(!0===a&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:a,groupId:t});return[(0,s.aZ)(l),(0,r.useCallback)((e=>{if(!l)return;const a=new URLSearchParams(n.location.search);a.set(l,e),n.replace({...n.location,search:a.toString()})}),[l,n])]}function y(e){const{defaultValue:a,queryString:t=!1,groupId:n}=e,l=c(e),[i,o]=(0,r.useState)((()=>function(e){let{defaultValue:a,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(a){if(!m({value:a,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${a}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return a}const n=t.find((e=>e.default))??t[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:a,tabValues:l}))),[s,u]=d({queryString:t,groupId:n}),[g,y]=function(e){let{groupId:a}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(a),[n,l]=(0,p.Dv)(t);return[n,(0,r.useCallback)((e=>{t&&l.set(e)}),[t,l])]}({groupId:n}),h=(()=>{const e=s??g;return m({value:e,tabValues:l})?e:null})();(0,r.useLayoutEffect)((()=>{h&&o(h)}),[h]);return{selectedValue:i,selectValue:(0,r.useCallback)((e=>{if(!m({value:e,tabValues:l}))throw new Error(`Can't select invalid tab value=${e}`);o(e),u(e),y(e)}),[u,y,l]),tabValues:l}}var h=t(92303);const N={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function b(e){let{className:a,block:t,selectedValue:o,selectValue:s,tabValues:u}=e;const p=[],{blockElementScrollPositionUntilNextRender:g}=(0,i.a_)(),c=e=>{const a=e.currentTarget,t=p.indexOf(a),n=u[t].value;n!==o&&(g(a),s(n))},m=e=>{let a=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const t=p.indexOf(e.currentTarget)+1;a=p[t]??p[0];break}case"ArrowLeft":{const t=p.indexOf(e.currentTarget)-1;a=p[t]??p[p.length-1];break}}a?.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.A)("tabs",{"tabs--block":t},a)},u.map((e=>{let{value:a,label:t,attributes:i}=e;return r.createElement("li",(0,n.A)({role:"tab",tabIndex:o===a?0:-1,"aria-selected":o===a,key:a,ref:e=>p.push(e),onKeyDown:m,onClick:c},i,{className:(0,l.A)("tabs__item",N.tabItem,i?.className,{"tabs__item--active":o===a})}),t??a)})))}function f(e){let{lazy:a,children:t,selectedValue:n}=e;const l=(Array.isArray(t)?t:[t]).filter(Boolean);if(a){const e=l.find((e=>e.props.value===n));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},l.map(((e,a)=>(0,r.cloneElement)(e,{key:a,hidden:e.props.value!==n}))))}function v(e){const a=y(e);return r.createElement("div",{className:(0,l.A)("tabs-container",N.tabList)},r.createElement(b,(0,n.A)({},e,a)),r.createElement(f,(0,n.A)({},e,a)))}function C(e){const a=(0,h.A)();return r.createElement(v,(0,n.A)({key:String(a)},e))}},5869:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>p,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>u,toc:()=>g});var n=t(58168),r=(t(96540),t(15680)),l=t(11470),i=t(19365);const o={id:"client-libraries-java",title:"Pulsar Java client",sidebar_label:"Java",original_id:"client-libraries-java"},s=void 0,u={unversionedId:"client-libraries-java",id:"version-2.10.x/client-libraries-java",title:"Pulsar Java client",description:"You can use a Pulsar Java client to create the Java producer, consumer, readers and TableView of messages and to perform administrative tasks. The current Java client version is 2.10.6.",source:"@site/versioned_docs/version-2.10.x/client-libraries-java.md",sourceDirName:".",slug:"/client-libraries-java",permalink:"/docs/2.10.x/client-libraries-java",draft:!1,editUrl:"https://github.com/apache/pulsar-site/edit/main/versioned_docs/version-2.10.x/client-libraries-java.md",tags:[],version:"2.10.x",frontMatter:{id:"client-libraries-java",title:"Pulsar Java client",sidebar_label:"Java",original_id:"client-libraries-java"},sidebar:"version-2.10.x/docsSidebar",previous:{title:"Overview",permalink:"/docs/2.10.x/client-libraries"},next:{title:"Go",permalink:"/docs/2.10.x/client-libraries-go"}},p={},g=[{value:"Installation",id:"installation",level:2},{value:"Maven",id:"maven",level:3},{value:"Gradle",id:"gradle",level:3},{value:"Connection URLs",id:"connection-urls",level:2},{value:"Client",id:"client",level:2},{value:"Client memory allocator configuration",id:"client-memory-allocator-configuration",level:3},{value:"Cluster-level failover",id:"cluster-level-failover",level:3},{value:"Producer",id:"producer",level:2},{value:"Configure producer",id:"configure-producer",level:3},{value:"Message routing",id:"message-routing",level:3},{value:"Async send",id:"async-send",level:3},{value:"Configure messages",id:"configure-messages",level:3},{value:"Enable chunking",id:"enable-chunking",level:3},{value:"Intercept messages",id:"intercept-messages",level:3},{value:"Consumer",id:"consumer",level:2},{value:"Configure consumer",id:"configure-consumer",level:3},{value:"Async receive",id:"async-receive",level:3},{value:"Batch receive",id:"batch-receive",level:3},{value:"Configure chunking",id:"configure-chunking",level:3},{value:"Negative acknowledgment redelivery backoff",id:"negative-acknowledgment-redelivery-backoff",level:3},{value:"Acknowledgement timeout redelivery backoff",id:"acknowledgement-timeout-redelivery-backoff",level:3},{value:"Multi-topic subscriptions",id:"multi-topic-subscriptions",level:3},{value:"Subscription types",id:"subscription-types",level:3},{value:"Exclusive",id:"exclusive",level:4},{value:"Failover",id:"failover",level:4},{value:"Shared",id:"shared",level:4},{value:"Key_shared",id:"key_shared",level:4},{value:"Intercept messages",id:"intercept-messages-1",level:3},{value:"Reader",id:"reader",level:2},{value:"Configure reader",id:"configure-reader",level:3},{value:"Sticky key range reader",id:"sticky-key-range-reader",level:3},{value:"TableView",id:"tableview",level:2},{value:"Configure TableView",id:"configure-tableview",level:3},{value:"Register listeners",id:"register-listeners",level:3},{value:"Schema",id:"schema",level:2},{value:"AvroBaseStructSchema example",id:"avrobasestructschema-example",level:3},{value:"ProtobufNativeSchema example",id:"protobufnativeschema-example",level:3},{value:"Authentication",id:"authentication",level:2},{value:"TLS Authentication",id:"tls-authentication",level:3},{value:"Athenz",id:"athenz",level:3},{value:"Oauth2",id:"oauth2",level:3}],c={toc:g},m="wrapper";function d(e){let{components:a,...o}=e;return(0,r.yg)(m,(0,n.A)({},c,o,{components:a,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"You can use a Pulsar Java client to create the Java ",(0,r.yg)("a",{parentName:"p",href:"#producer"},"producer"),", ",(0,r.yg)("a",{parentName:"p",href:"#consumer"},"consumer"),", ",(0,r.yg)("a",{parentName:"p",href:"#reader"},"readers")," and ",(0,r.yg)("a",{parentName:"p",href:"#tableview"},"TableView")," of messages and to perform ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/admin-api-overview"},"administrative tasks"),". The current Java client version is ",(0,r.yg)("strong",{parentName:"p"},"2.10.6"),"."),(0,r.yg)("p",null,"All the methods in ",(0,r.yg)("a",{parentName:"p",href:"#producer"},"producer"),", ",(0,r.yg)("a",{parentName:"p",href:"#consumer"},"consumer"),", ",(0,r.yg)("a",{parentName:"p",href:"#reader"},"readers")," and ",(0,r.yg)("a",{parentName:"p",href:"#tableview"},"TableView")," of a Java client are thread-safe."),(0,r.yg)("p",null,"Javadoc for the Pulsar client is divided into two domains by package as follows."),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Package"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Description"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Maven Artifact"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("a",{parentName:"td",href:"https://pulsar.apache.org/api/client/2.10.x"},(0,r.yg)("inlineCode",{parentName:"a"},"org.apache.pulsar.client.api"))),(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("a",{parentName:"td",href:"https://pulsar.apache.org/api/client/2.10.x/"},"The producer and consumer API")),(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("a",{parentName:"td",href:"http://search.maven.org/#artifactdetails%7Corg.apache.pulsar%7Cpulsar-client%7C2.10.6%7Cjar"},"org.apache.pulsar:pulsar-client:2.10.6"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("a",{parentName:"td",href:"https://pulsar.apache.org/api/admin/2.10.x"},(0,r.yg)("inlineCode",{parentName:"a"},"org.apache.pulsar.client.admin"))),(0,r.yg)("td",{parentName:"tr",align:"left"},"The Java ",(0,r.yg)("a",{parentName:"td",href:"/docs/2.10.x/admin-api-overview"},"admin API")),(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("a",{parentName:"td",href:"http://search.maven.org/#artifactdetails%7Corg.apache.pulsar%7Cpulsar-client-admin%7C2.10.6%7Cjar"},"org.apache.pulsar:pulsar-client-admin:2.10.6"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("inlineCode",{parentName:"td"},"org.apache.pulsar.client.all")),(0,r.yg)("td",{parentName:"tr",align:"left"},"Include both ",(0,r.yg)("inlineCode",{parentName:"td"},"pulsar-client")," and ",(0,r.yg)("inlineCode",{parentName:"td"},"pulsar-client-admin"),(0,r.yg)("br",null)," Both ",(0,r.yg)("inlineCode",{parentName:"td"},"pulsar-client")," and ",(0,r.yg)("inlineCode",{parentName:"td"},"pulsar-client-admin")," are shaded packages and they shade dependencies independently. Consequently, the applications using both ",(0,r.yg)("inlineCode",{parentName:"td"},"pulsar-client")," and ",(0,r.yg)("inlineCode",{parentName:"td"},"pulsar-client-admin")," have redundant shaded classes. It would be troublesome if you introduce new dependencies but forget to update shading rules. ",(0,r.yg)("br",null)," In this case, you can use ",(0,r.yg)("inlineCode",{parentName:"td"},"pulsar-client-all"),", which shades dependencies only one time and reduces the size of dependencies."),(0,r.yg)("td",{parentName:"tr",align:"left"},(0,r.yg)("a",{parentName:"td",href:"http://search.maven.org/#artifactdetails%7Corg.apache.pulsar%7Cpulsar-client-all%7C2.10.6%7Cjar"},"org.apache.pulsar:pulsar-client-all:2.10.6"))))),(0,r.yg)("p",null,"This document focuses only on the client API for producing and consuming messages on Pulsar topics. For how to use the Java admin client, see ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/admin-api-overview"},"Pulsar admin interface"),"."),(0,r.yg)("h2",{id:"installation"},"Installation"),(0,r.yg)("p",null,"The latest version of the Pulsar Java client library is available via ",(0,r.yg)("a",{parentName:"p",href:"http://search.maven.org/#artifactdetails%7Corg.apache.pulsar%7Cpulsar-client%7C2.10.6%7Cjar"},"Maven Central"),". To use the latest version, add the ",(0,r.yg)("inlineCode",{parentName:"p"},"pulsar-client")," library to your build configuration."),(0,r.yg)("admonition",{type:"tip"},(0,r.yg)("ul",{parentName:"admonition"},(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"https://search.maven.org/artifact/org.apache.pulsar/pulsar-client"},(0,r.yg)("inlineCode",{parentName:"a"},"pulsar-client"))," and ",(0,r.yg)("a",{parentName:"li",href:"https://search.maven.org/artifact/org.apache.pulsar/pulsar-client-admin"},(0,r.yg)("inlineCode",{parentName:"a"},"pulsar-client-admin"))," shade dependencies via ",(0,r.yg)("a",{parentName:"li",href:"https://maven.apache.org/plugins/maven-shade-plugin/"},"maven-shade-plugin")," to avoid conflicts of the underlying dependency packages (such as Netty). If you do not want to manage dependency conflicts manually, you can use them."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"https://search.maven.org/artifact/org.apache.pulsar/pulsar-client-original"},(0,r.yg)("inlineCode",{parentName:"a"},"pulsar-client-original"))," and ",(0,r.yg)("a",{parentName:"li",href:"https://search.maven.org/artifact/org.apache.pulsar/pulsar-client-admin-original"},(0,r.yg)("inlineCode",{parentName:"a"},"pulsar-client-admin-original"))," ",(0,r.yg)("strong",{parentName:"li"},"does not")," shade dependencies. If you want to manage dependencies manually, you can use them."))),(0,r.yg)("h3",{id:"maven"},"Maven"),(0,r.yg)("p",null,"If you use Maven, add the following information to the ",(0,r.yg)("inlineCode",{parentName:"p"},"pom.xml")," file."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-xml"},"\n\x3c!-- in your <properties> block --\x3e\n<pulsar.version>2.10.6</pulsar.version>\n\n\x3c!-- in your <dependencies> block --\x3e\n<dependency>\n  <groupId>org.apache.pulsar</groupId>\n  <artifactId>pulsar-client</artifactId>\n  <version>${pulsar.version}</version>\n</dependency>\n\n")),(0,r.yg)("h3",{id:"gradle"},"Gradle"),(0,r.yg)("p",null,"If you use Gradle, add the following information to the ",(0,r.yg)("inlineCode",{parentName:"p"},"build.gradle")," file."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-groovy"},"\ndef pulsarVersion = '2.10.6'\n\ndependencies {\n    compile group: 'org.apache.pulsar', name: 'pulsar-client', version: pulsarVersion\n}\n\n")),(0,r.yg)("h2",{id:"connection-urls"},"Connection URLs"),(0,r.yg)("p",null,"To connect to Pulsar using client libraries, you need to specify a ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/developing-binary-protocol"},"Pulsar protocol")," URL."),(0,r.yg)("p",null,"You can assign Pulsar protocol URLs to specific clusters and use the ",(0,r.yg)("inlineCode",{parentName:"p"},"pulsar")," scheme. The default port is ",(0,r.yg)("inlineCode",{parentName:"p"},"6650"),". The following is an example of ",(0,r.yg)("inlineCode",{parentName:"p"},"localhost"),"."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-http"},"\npulsar://localhost:6650\n\n")),(0,r.yg)("p",null,"If you have multiple brokers, the URL is as follows."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-http"},"\npulsar://localhost:6550,localhost:6651,localhost:6652\n\n")),(0,r.yg)("p",null,"A URL for a production Pulsar cluster is as follows."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-http"},"\npulsar://pulsar.us-west.example.com:6650\n\n")),(0,r.yg)("p",null,"If you use ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/security-tls-authentication"},"TLS")," authentication, the URL is as follows."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-http"},"\npulsar+ssl://pulsar.us-west.example.com:6651\n\n")),(0,r.yg)("h2",{id:"client"},"Client"),(0,r.yg)("p",null,"You can instantiate a ",(0,r.yg)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/2.10.x/org/apache/pulsar/client/api/PulsarClient"},"PulsarClient")," object using just a URL for the target Pulsar ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/reference-terminology#cluster"},"cluster")," like this:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nPulsarClient client = PulsarClient.builder()\n        .serviceUrl("pulsar://localhost:6650")\n        .build();\n\n')),(0,r.yg)("p",null,"If you have multiple brokers, you can initiate a PulsarClient like this:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nPulsarClient client = PulsarClient.builder()\n        .serviceUrl("pulsar://localhost:6650,localhost:6651,localhost:6652")\n        .build();\n\n')),(0,r.yg)("blockquote",null,(0,r.yg)("h3",{parentName:"blockquote",id:"default-broker-urls-for-standalone-clusters"},"Default broker URLs for standalone clusters"),(0,r.yg)("p",{parentName:"blockquote"},"If you run a cluster in ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/getting-started-standalone"},"standalone mode"),", the broker is available at the ",(0,r.yg)("inlineCode",{parentName:"p"},"pulsar://localhost:6650")," URL by default.")),(0,r.yg)("p",null,"If you create a client, you can use the ",(0,r.yg)("inlineCode",{parentName:"p"},"loadConf")," configuration. The following parameters are available in ",(0,r.yg)("inlineCode",{parentName:"p"},"loadConf"),"."),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Name"),(0,r.yg)("th",{parentName:"tr",align:null},"Type"),(0,r.yg)("th",{parentName:"tr",align:null},(0,r.yg)("div",null,"Description")),(0,r.yg)("th",{parentName:"tr",align:null},"Default"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"serviceUrl")),(0,r.yg)("td",{parentName:"tr",align:null},"String"),(0,r.yg)("td",{parentName:"tr",align:null},"Service URL provider for Pulsar service"),(0,r.yg)("td",{parentName:"tr",align:null},"None")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"authPluginClassName")),(0,r.yg)("td",{parentName:"tr",align:null},"String"),(0,r.yg)("td",{parentName:"tr",align:null},"Name of the authentication plugin"),(0,r.yg)("td",{parentName:"tr",align:null},"None")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"authParams")),(0,r.yg)("td",{parentName:"tr",align:null},"String"),(0,r.yg)("td",{parentName:"tr",align:null},"Parameters for the authentication plugin ",(0,r.yg)("br",null),(0,r.yg)("br",null),(0,r.yg)("strong",{parentName:"td"},"Example"),(0,r.yg)("br",null)," key1:val1,key2:val2"),(0,r.yg)("td",{parentName:"tr",align:null},"None")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"operationTimeoutMs")),(0,r.yg)("td",{parentName:"tr",align:null},"long"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"operationTimeoutMs")),(0,r.yg)("td",{parentName:"tr",align:null},"Operation timeout")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"statsIntervalSeconds")),(0,r.yg)("td",{parentName:"tr",align:null},"long"),(0,r.yg)("td",{parentName:"tr",align:null},"Interval between each stats information",(0,r.yg)("br",null),(0,r.yg)("br",null),"Stats is activated with positive ",(0,r.yg)("inlineCode",{parentName:"td"},"statsInterval"),(0,r.yg)("br",null),(0,r.yg)("br",null),"Set ",(0,r.yg)("inlineCode",{parentName:"td"},"statsIntervalSeconds")," to 1 second at least."),(0,r.yg)("td",{parentName:"tr",align:null},"60")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"numIoThreads")),(0,r.yg)("td",{parentName:"tr",align:null},"int"),(0,r.yg)("td",{parentName:"tr",align:null},"The number of threads used for handling connections to brokers"),(0,r.yg)("td",{parentName:"tr",align:null},"1")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"numListenerThreads")),(0,r.yg)("td",{parentName:"tr",align:null},"int"),(0,r.yg)("td",{parentName:"tr",align:null},'The number of threads used for handling message listeners. The listener thread pool is shared across all the consumers and readers using the "listener" model to get messages. For a given consumer, the listener is always invoked from the same thread to ensure ordering. If you want multiple threads to process a single topic, you need to create a ',(0,r.yg)("a",{parentName:"td",href:"/docs/2.10.x/concepts-messaging#shared"},(0,r.yg)("inlineCode",{parentName:"a"},"shared"))," subscription and multiple consumers for this subscription. This does not ensure ordering."),(0,r.yg)("td",{parentName:"tr",align:null},"1")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"useTcpNoDelay")),(0,r.yg)("td",{parentName:"tr",align:null},"boolean"),(0,r.yg)("td",{parentName:"tr",align:null},"Whether to use TCP no-delay flag on the connection to disable Nagle algorithm"),(0,r.yg)("td",{parentName:"tr",align:null},"true")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"enableTls")),(0,r.yg)("td",{parentName:"tr",align:null},"boolean"),(0,r.yg)("td",{parentName:"tr",align:null},"Whether to use TLS encryption on the connection. Note that this parameter is ",(0,r.yg)("strong",{parentName:"td"},"deprecated"),". If you want to enable TLS, use ",(0,r.yg)("inlineCode",{parentName:"td"},"pulsar+ssl://")," in ",(0,r.yg)("inlineCode",{parentName:"td"},"serviceUrl")," instead."),(0,r.yg)("td",{parentName:"tr",align:null},"false")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"tlsTrustCertsFilePath")),(0,r.yg)("td",{parentName:"tr",align:null},"string"),(0,r.yg)("td",{parentName:"tr",align:null},"Path to the trusted TLS certificate file"),(0,r.yg)("td",{parentName:"tr",align:null},"None")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"tlsAllowInsecureConnection")),(0,r.yg)("td",{parentName:"tr",align:null},"boolean"),(0,r.yg)("td",{parentName:"tr",align:null},"Whether the Pulsar client accepts untrusted TLS certificate from broker"),(0,r.yg)("td",{parentName:"tr",align:null},"false")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"tlsHostnameVerificationEnable")),(0,r.yg)("td",{parentName:"tr",align:null},"boolean"),(0,r.yg)("td",{parentName:"tr",align:null},"Whether to enable TLS hostname verification"),(0,r.yg)("td",{parentName:"tr",align:null},"false")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"concurrentLookupRequest")),(0,r.yg)("td",{parentName:"tr",align:null},"int"),(0,r.yg)("td",{parentName:"tr",align:null},"The number of concurrent lookup requests allowed to send on each broker connection to prevent overload on broker"),(0,r.yg)("td",{parentName:"tr",align:null},"5000")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"maxLookupRequest")),(0,r.yg)("td",{parentName:"tr",align:null},"int"),(0,r.yg)("td",{parentName:"tr",align:null},"The maximum number of lookup requests allowed on each broker connection to prevent overload on broker"),(0,r.yg)("td",{parentName:"tr",align:null},"50000")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"maxNumberOfRejectedRequestPerConnection")),(0,r.yg)("td",{parentName:"tr",align:null},"int"),(0,r.yg)("td",{parentName:"tr",align:null},"The maximum number of rejected requests of a broker in a certain time frame (60 seconds) after the current connection is closed and the client creates a new connection to connect to a different broker"),(0,r.yg)("td",{parentName:"tr",align:null},"50")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"keepAliveIntervalSeconds")),(0,r.yg)("td",{parentName:"tr",align:null},"int"),(0,r.yg)("td",{parentName:"tr",align:null},"Seconds of keeping alive interval for each client broker connection"),(0,r.yg)("td",{parentName:"tr",align:null},"30")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"connectionTimeoutMs")),(0,r.yg)("td",{parentName:"tr",align:null},"int"),(0,r.yg)("td",{parentName:"tr",align:null},"Duration of waiting for a connection to a broker to be established ",(0,r.yg)("br",null),(0,r.yg)("br",null),"If the duration passes without a response from a broker, the connection attempt is dropped"),(0,r.yg)("td",{parentName:"tr",align:null},"10000")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"requestTimeoutMs")),(0,r.yg)("td",{parentName:"tr",align:null},"int"),(0,r.yg)("td",{parentName:"tr",align:null},"Maximum duration for completing a request"),(0,r.yg)("td",{parentName:"tr",align:null},"60000")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"defaultBackoffIntervalNanos")),(0,r.yg)("td",{parentName:"tr",align:null},"int"),(0,r.yg)("td",{parentName:"tr",align:null},"Default duration for a backoff interval"),(0,r.yg)("td",{parentName:"tr",align:null},"TimeUnit.MILLISECONDS.toNanos(100);")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"maxBackoffIntervalNanos")),(0,r.yg)("td",{parentName:"tr",align:null},"long"),(0,r.yg)("td",{parentName:"tr",align:null},"Maximum duration for a backoff interval"),(0,r.yg)("td",{parentName:"tr",align:null},"TimeUnit.SECONDS.toNanos(30)")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"socks5ProxyAddress")),(0,r.yg)("td",{parentName:"tr",align:null},"SocketAddress"),(0,r.yg)("td",{parentName:"tr",align:null},"SOCKS5 proxy address"),(0,r.yg)("td",{parentName:"tr",align:null},"None")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"socks5ProxyUsername")),(0,r.yg)("td",{parentName:"tr",align:null},"string"),(0,r.yg)("td",{parentName:"tr",align:null},"SOCKS5 proxy username"),(0,r.yg)("td",{parentName:"tr",align:null},"None")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"socks5ProxyPassword")),(0,r.yg)("td",{parentName:"tr",align:null},"string"),(0,r.yg)("td",{parentName:"tr",align:null},"SOCKS5 proxy password"),(0,r.yg)("td",{parentName:"tr",align:null},"None")))),(0,r.yg)("p",null,"Check out the Javadoc for the ",(0,r.yg)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/2.10.x/org/apache/pulsar/client/api/PulsarClient"},"PulsarClient")," class for a full list of configurable parameters."),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},"In addition to client-level configuration, you can also apply ",(0,r.yg)("a",{parentName:"p",href:"#configure-producer"},"producer")," and ",(0,r.yg)("a",{parentName:"p",href:"#configure-consumer"},"consumer")," specific configuration as described in sections below.")),(0,r.yg)("h3",{id:"client-memory-allocator-configuration"},"Client memory allocator configuration"),(0,r.yg)("p",null,"You can set the client memory allocator configurations through Java properties.",(0,r.yg)("br",null)),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Property"),(0,r.yg)("th",{parentName:"tr",align:null},"Type"),(0,r.yg)("th",{parentName:"tr",align:null},(0,r.yg)("div",null,"Description")),(0,r.yg)("th",{parentName:"tr",align:null},"Default"),(0,r.yg)("th",{parentName:"tr",align:null},"Available values"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"pulsar.allocator.pooled")),(0,r.yg)("td",{parentName:"tr",align:null},"String"),(0,r.yg)("td",{parentName:"tr",align:null},"If set to ",(0,r.yg)("inlineCode",{parentName:"td"},"true"),", the client uses a direct memory pool. ",(0,r.yg)("br",null)," If set to ",(0,r.yg)("inlineCode",{parentName:"td"},"false"),", the client uses a heap memory without pool"),(0,r.yg)("td",{parentName:"tr",align:null},"true"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("li",null," true ")," ",(0,r.yg)("li",null," false "))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"pulsar.allocator.exit_on_oom")),(0,r.yg)("td",{parentName:"tr",align:null},"String"),(0,r.yg)("td",{parentName:"tr",align:null},"Whether to exit the JVM when OOM happens"),(0,r.yg)("td",{parentName:"tr",align:null},"false"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("li",null," true ")," ",(0,r.yg)("li",null," false "))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"pulsar.allocator.leak_detection")),(0,r.yg)("td",{parentName:"tr",align:null},"String"),(0,r.yg)("td",{parentName:"tr",align:null},"The leak detection policy for Pulsar bytebuf allocator. ",(0,r.yg)("li",null," ",(0,r.yg)("strong",{parentName:"td"},"Disabled"),": No leak detection and no overhead. ")," ",(0,r.yg)("li",null," ",(0,r.yg)("strong",{parentName:"td"},"Simple"),": Instruments 1% of the allocated buffer to track for leaks. ")," ",(0,r.yg)("li",null," ",(0,r.yg)("strong",{parentName:"td"},"Advanced"),": Instruments 1% of the allocated buffer to track for leaks, reporting stack traces of places where the buffer is used. ")," ",(0,r.yg)("li",null," ",(0,r.yg)("strong",{parentName:"td"},"Paranoid"),": Instruments 100% of the allocated buffer to track for leaks, reporting stack traces of places where the buffer is used and introduces a significant overhead. ")),(0,r.yg)("td",{parentName:"tr",align:null},"Disabled"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("li",null," Disabled ")," ",(0,r.yg)("li",null," Simple ")," ",(0,r.yg)("li",null," Advanced ")," ",(0,r.yg)("li",null," Paranoid "))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"pulsar.allocator.out_of_memory_policy")),(0,r.yg)("td",{parentName:"tr",align:null},"String"),(0,r.yg)("td",{parentName:"tr",align:null},"When an OOM occurs, the client throws an exception or fallbacks to heap"),(0,r.yg)("td",{parentName:"tr",align:null},"FallbackToHeap"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("li",null," ThrowException ")," ",(0,r.yg)("li",null," FallbackToHeap "))))),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Example"),":"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"\n-Dpulsar.allocator.pooled=true\n-Dpulsar.allocator.exit_on_oom=false\n-Dpulsar.allocator.leak_detection=Disabled\n-Dpulsar.allocator.out_of_memory_policy=ThrowException\n\n")),(0,r.yg)("h3",{id:"cluster-level-failover"},"Cluster-level failover"),(0,r.yg)("p",null,"This chapter describes the concept, benefits, use cases, constraints, usage, working principles, and more information about the cluster-level failover. It contains the following sections:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("a",{parentName:"p",href:"#what-is-cluster-level-failover"},"What is cluster-level failover?")),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("a",{parentName:"p",href:"#concept-of-cluster-level-failover"},"Concept of cluster-level failover"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("a",{parentName:"p",href:"#why-use-cluster-level-failover"},"Why use cluster-level failover?"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("a",{parentName:"p",href:"#when-to-use-cluster-level-failover"},"When to use cluster-level failover?"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("a",{parentName:"p",href:"#when-cluster-level-failover-is-triggered"},"When cluster-level failover is triggered?"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("a",{parentName:"p",href:"#why-does-cluster-level-failover-fail"},"Why does cluster-level failover fail?"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("a",{parentName:"p",href:"#what-are-the-limitations-of-cluster-level-failover"},"What are the limitations of cluster-level failover?"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("a",{parentName:"p",href:"#what-are-the-relationships-between-cluster-level-failover-and-geo-replication"},"What are the relationships between cluster-level failover and geo-replication?"))))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("a",{parentName:"p",href:"#how-to-use-cluster-level-failover"},"How to use cluster-level failover?"))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("a",{parentName:"p",href:"#how-does-cluster-level-failover-work"},"How does cluster-level failover work?")))),(0,r.yg)("blockquote",null,(0,r.yg)("h4",{parentName:"blockquote",id:"what-is-cluster-level-failover"},"What is cluster-level failover")),(0,r.yg)("p",null,"This chapter helps you better understand the concept of cluster-level failover."),(0,r.yg)("blockquote",null,(0,r.yg)("h5",{parentName:"blockquote",id:"concept-of-cluster-level-failover"},"Concept of cluster-level failover")),(0,r.yg)(l.A,{defaultValue:"Automatic cluster-level failover",values:[{label:"Automatic cluster-level failover",value:"Automatic cluster-level failover"},{label:"Controlled cluster-level failover",value:"Controlled cluster-level failover"}],mdxType:"Tabs"},(0,r.yg)(i.A,{value:"Automatic cluster-level failover",mdxType:"TabItem"},(0,r.yg)("p",null,"Automatic cluster-level failover supports Pulsar clients switching from a primary cluster to one or several backup clusters automatically and seamlessly when it detects a failover event based on the configured detecting policy set by ",(0,r.yg)("strong",{parentName:"p"},"users"),"."),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Automatic cluster-level failover",src:t(79635).A,width:"1084",height:"640"}))),(0,r.yg)(i.A,{value:"Controlled cluster-level failover",mdxType:"TabItem"},(0,r.yg)("p",null,"Controlled cluster-level failover supports Pulsar clients switching from a primary cluster to one or several backup clusters. The switchover is manually set by ",(0,r.yg)("strong",{parentName:"p"},"administrators"),"."),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Controlled cluster-level failover",src:t(84024).A,width:"1080",height:"652"})))),(0,r.yg)("p",null,"Once the primary cluster functions again, Pulsar clients can switch back to the primary cluster. Most of the time users won\u2019t even notice a thing. Users can keep using applications and services without interruptions or timeouts."),(0,r.yg)("blockquote",null,(0,r.yg)("h5",{parentName:"blockquote",id:"why-use-cluster-level-failover"},"Why use cluster-level failover?")),(0,r.yg)("p",null,"The cluster-level failover provides fault tolerance, continuous availability, and high availability together. It brings a number of benefits, including but not limited to:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Reduced cost: services can be switched and recovered automatically with no data loss.")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},'Simplified management: businesses can operate on an "always-on" basis since no immediate user intervention is required.')),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Improved stability and robustness: it ensures continuous performance and minimizes service downtime."))),(0,r.yg)("blockquote",null,(0,r.yg)("h5",{parentName:"blockquote",id:"when-to-use-cluster-level-failover"},"When to use cluster-level failover?")),(0,r.yg)("p",null,"The cluster-level failover protects your environment in a number of ways, including but not limited to:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Disaster recovery: cluster-level failover can automatically and seamlessly transfer the production workload on a primary cluster to one or several backup clusters, which ensures minimum data loss and reduced recovery time.")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Planned migration: if you want to migrate production workloads from an old cluster to a new cluster, you can improve the migration efficiency with cluster-level failover. For example, you can test whether the data migration goes smoothly in case of a failover event, identify possible issues and risks before the migration."))),(0,r.yg)("blockquote",null,(0,r.yg)("h5",{parentName:"blockquote",id:"when-cluster-level-failover-is-triggered"},"When cluster-level failover is triggered?")),(0,r.yg)(l.A,{defaultValue:"Automatic cluster-level failover",values:[{label:"Automatic cluster-level failover",value:"Automatic cluster-level failover"},{label:"Controlled cluster-level failover",value:"Controlled cluster-level failover"}],mdxType:"Tabs"},(0,r.yg)(i.A,{value:"Automatic cluster-level failover",mdxType:"TabItem"},(0,r.yg)("p",null,"Automatic cluster-level failover is triggered when Pulsar clients cannot connect to the primary cluster for a prolonged period of time. This can be caused by any number of reasons including, but not limited to:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Network failure: internet connection is lost.")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Power failure: shutdown time of a primary cluster exceeds time limits.")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Service error: errors occur on a primary cluster (for example, the primary cluster does not function because of time limits).")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Crashed storage space: the primary cluster does not have enough storage space, but the corresponding storage space on the backup server functions normally.")))),(0,r.yg)(i.A,{value:"Controlled cluster-level failover",mdxType:"TabItem"},(0,r.yg)("p",null,"Controlled cluster-level failover is triggered when administrators set the switchover manually."))),(0,r.yg)("blockquote",null,(0,r.yg)("h5",{parentName:"blockquote",id:"why-does-cluster-level-failover-fail"},"Why does cluster-level failover fail?")),(0,r.yg)("p",null,"Obviously, the cluster-level failover does not succeed if the backup cluster is unreachable by active Pulsar clients. This can happen for many reasons, including but not limited to:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Power failure: the backup cluster is shut down or does not function normally.")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Crashed storage space: primary and backup clusters do not have enough storage space.")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"If the failover is initiated, but no cluster can assume the role of an available cluster due to errors, and the primary cluster is not able to provide service normally.")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"If you manually initiate a switchover, but services cannot be switched to the backup cluster server, then the system will attempt to switch services back to the primary cluster.")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Fail to authenticate or authorize between 1) primary and backup clusters, or 2) between two backup clusters."))),(0,r.yg)("blockquote",null,(0,r.yg)("h5",{parentName:"blockquote",id:"what-are-the-limitations-of-cluster-level-failover"},"What are the limitations of cluster-level failover?")),(0,r.yg)("p",null,"Currently, cluster-level failover can perform probes to prevent data loss, but it can not check the status of backup clusters. If backup clusters are not healthy, you cannot produce or consume data."),(0,r.yg)("blockquote",null,(0,r.yg)("h4",{parentName:"blockquote",id:"what-are-the-relationships-between-cluster-level-failover-and-geo-replication"},"What are the relationships between cluster-level failover and geo-replication?")),(0,r.yg)("p",null,"The cluster-level failover is an extension of ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/concepts-replication"},"geo-replication")," to improve stability and robustness. The cluster-level failover depends on geo-replication, and they have some ",(0,r.yg)("strong",{parentName:"p"},"differences")," as below."),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Influence"),(0,r.yg)("th",{parentName:"tr",align:null},"Cluster-level failover"),(0,r.yg)("th",{parentName:"tr",align:null},"Geo-replication"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"Do administrators have heavy workloads?"),(0,r.yg)("td",{parentName:"tr",align:null},"No or maybe.",(0,r.yg)("br",null),(0,r.yg)("br",null),"- For the ",(0,r.yg)("strong",{parentName:"td"},"automatic")," cluster-level failover, the cluster switchover is triggered automatically based on the policies set by ",(0,r.yg)("strong",{parentName:"td"},"users"),".",(0,r.yg)("br",null),(0,r.yg)("br",null),"- For the ",(0,r.yg)("strong",{parentName:"td"},"controlled")," cluster-level failover, the switchover is triggered manually by ",(0,r.yg)("strong",{parentName:"td"},"administrators"),"."),(0,r.yg)("td",{parentName:"tr",align:null},"Yes.",(0,r.yg)("br",null),(0,r.yg)("br",null),"If a cluster fails, immediate administration intervention is required.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"Result in data loss?"),(0,r.yg)("td",{parentName:"tr",align:null},"No.",(0,r.yg)("br",null),(0,r.yg)("br",null),"For both ",(0,r.yg)("strong",{parentName:"td"},"automatic")," and ",(0,r.yg)("strong",{parentName:"td"},"controlled")," cluster-level failover, if the failed primary cluster doesn't replicate messages immediately to the backup cluster, the Pulsar client can't consume the non-replicated messages. After the primary cluster is restored and the Pulsar client switches back, the non-replicated data can still be consumed by the Pulsar client. Consequently, the data is not lost.",(0,r.yg)("br",null),(0,r.yg)("br",null),"- For the ",(0,r.yg)("strong",{parentName:"td"},"automatic")," cluster-level failover, services can be switched and recovered automatically with no data loss.",(0,r.yg)("br",null),(0,r.yg)("br",null),"- For the ",(0,r.yg)("strong",{parentName:"td"},"controlled")," cluster-level failover, services can be switched and recovered manually and data loss may happen."),(0,r.yg)("td",{parentName:"tr",align:null},"Yes.",(0,r.yg)("br",null),(0,r.yg)("br",null),"Pulsar clients and DNS systems have caches. When administrators switch the DNS from a primary cluster to a backup cluster, it takes some time for cache trigger timeout, which delays client recovery time and fails to produce or consume messages.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},"Result in Pulsar client failure?"),(0,r.yg)("td",{parentName:"tr",align:null},"No or maybe.",(0,r.yg)("br",null),(0,r.yg)("br",null),"- For ",(0,r.yg)("strong",{parentName:"td"},"automatic")," cluster-level failover, services can be switched and recovered automatically and the Pulsar client does not fail. ",(0,r.yg)("br",null),(0,r.yg)("br",null),"- For ",(0,r.yg)("strong",{parentName:"td"},"controlled")," cluster-level failover, services can be switched and recovered manually, but the Pulsar client fails before administrators can take action."),(0,r.yg)("td",{parentName:"tr",align:null},"Same as above.")))),(0,r.yg)("blockquote",null,(0,r.yg)("h4",{parentName:"blockquote",id:"how-to-use-cluster-level-failover"},"How to use cluster-level failover")),(0,r.yg)("p",null,"This section guides you through every step on how to configure cluster-level failover."),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Tip")),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"You should configure cluster-level failover only when the cluster contains sufficient resources to handle all possible consequences. Workload intensity on the backup cluster may increase significantly.")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Connect clusters to an uninterruptible power supply (UPS) unit to reduce the risk of unexpected power loss."))),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Requirements")),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Pulsar client 2.10 or later versions.")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"For backup clusters:"),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"The number of BookKeeper nodes should be equal to or greater than the ensemble quorum.")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"The number of ZooKeeper nodes should be equal to or greater than 3.")))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"Turn on geo-replication")," between the primary cluster and any dependent cluster (primary to backup or backup to backup) to prevent data loss.")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/administration-geo#enable-replicated-subscription"},"Enable replicated subscription"),"."))),(0,r.yg)(l.A,{defaultValue:"Automatic cluster-level failover",values:[{label:"Automatic cluster-level failover",value:"Automatic cluster-level failover"},{label:"Controlled cluster-level failover",value:"Controlled cluster-level failover"}],mdxType:"Tabs"},(0,r.yg)(i.A,{value:"Automatic cluster-level failover",mdxType:"TabItem"},(0,r.yg)("p",null,"This is an example of how to construct a Java Pulsar client to use automatic cluster-level failover. The switchover is triggered automatically."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'private PulsarClient getAutoFailoverClient() throws PulsarClientException {\n    String primaryUrl = "pulsar+ssl://localhost:6651";\n    String secondaryUrl = "pulsar+ssl://localhost:6661";\n\n    String primaryTlsTrustCertsFilePath = "primary/path";\n    Authentication primaryAuthentication = AuthenticationFactory.create(\n        "org.apache.pulsar.client.impl.auth.AuthenticationTls",\n        "tlsCertFile:/path/to/primary-my-role.cert.pem,"\n                + "tlsKeyFile:/path/to/primary-role.key-pk8.pem");\n\n    String secondaryTlsTrustCertsFilePath = "secondary/path";\n    Authentication secondaryAuthentication = AuthenticationFactory.create(\n        "org.apache.pulsar.client.impl.auth.AuthenticationTls",\n        "tlsCertFile:/path/to/secondary-my-role.cert.pem,"\n                + "tlsKeyFile:/path/to/secondary-role.key-pk8.pem");\n\n    // You can put more failover cluster config in to map\n    Map<String, String> secondaryTlsTrustCertsFilePaths = new HashMap<>();\n    secondaryTlsTrustCertsFilePaths.put(secondaryUrl, secondaryTlsTrustCertsFilePath);\n\n    Map<String, Authentication> secondaryAuthentications = new HashMap<>();\n    secondaryAuthentications.put(secondaryUrl, secondaryAuthentication);\n\n    ServiceUrlProvider failover = AutoClusterFailover.builder()\n        .primary(primaryUrl)\n        .secondary(List.of(secondaryUrl))\n        .failoverDelay(30, TimeUnit.SECONDS)\n        .switchBackDelay(60, TimeUnit.SECONDS)\n        .checkInterval(1000, TimeUnit.MILLISECONDS)\n        .secondaryTlsTrustCertsFilePath(secondaryTlsTrustCertsFilePaths)\n        .secondaryAuthentication(secondaryAuthentications)\n        .build();\n\n    PulsarClient pulsarClient = PulsarClient.builder()\n        .serviceUrlProvider(failover)\n        .authentication(primaryAuthentication)\n        .tlsTrustCertsFilePath(primaryTlsTrustCertsFilePath)\n        .build();\n\n    failover.initialize(pulsarClient);\n    return pulsarClient;\n}\n')),(0,r.yg)("p",null,"Configure the following parameters:"),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Parameter"),(0,r.yg)("th",{parentName:"tr",align:null},"Default value"),(0,r.yg)("th",{parentName:"tr",align:null},"Required?"),(0,r.yg)("th",{parentName:"tr",align:null},"Description"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"primary")),(0,r.yg)("td",{parentName:"tr",align:null},"N/A"),(0,r.yg)("td",{parentName:"tr",align:null},"Yes"),(0,r.yg)("td",{parentName:"tr",align:null},"Service URL of the primary cluster.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"secondary")),(0,r.yg)("td",{parentName:"tr",align:null},"N/A"),(0,r.yg)("td",{parentName:"tr",align:null},"Yes"),(0,r.yg)("td",{parentName:"tr",align:null},"Service URL(s) of one or several backup clusters.",(0,r.yg)("br",null),(0,r.yg)("br",null),"You can specify several backup clusters using a comma-separated list.",(0,r.yg)("br",null),(0,r.yg)("br",null)," Note that:",(0,r.yg)("br",null),"- The backup cluster is chosen in the sequence shown in the list. ",(0,r.yg)("br",null),"- If all backup clusters are available, the Pulsar client chooses the first backup cluster.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"failoverDelay")),(0,r.yg)("td",{parentName:"tr",align:null},"N/A"),(0,r.yg)("td",{parentName:"tr",align:null},"Yes"),(0,r.yg)("td",{parentName:"tr",align:null},"The delay before the Pulsar client switches from the primary cluster to the backup cluster.",(0,r.yg)("br",null),(0,r.yg)("br",null),"Automatic failover is controlled by a probe task: ",(0,r.yg)("br",null),"1) The probe task first checks the health status of the primary cluster. ",(0,r.yg)("br",null)," 2) If the probe task finds the continuous failure time of the primary cluster exceeds ",(0,r.yg)("inlineCode",{parentName:"td"},"failoverDelayMs"),", it switches the Pulsar client to the backup cluster.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"switchBackDelay")),(0,r.yg)("td",{parentName:"tr",align:null},"N/A"),(0,r.yg)("td",{parentName:"tr",align:null},"Yes"),(0,r.yg)("td",{parentName:"tr",align:null},"The delay before the Pulsar client switches from the backup cluster to the primary cluster.",(0,r.yg)("br",null),(0,r.yg)("br",null),"Automatic failover switchover is controlled by a probe task: ",(0,r.yg)("br",null)," 1) After the Pulsar client switches from the primary cluster to the backup cluster, the probe task continues to check the status of the primary cluster. ",(0,r.yg)("br",null)," 2) If the primary cluster functions well and continuously remains active longer than ",(0,r.yg)("inlineCode",{parentName:"td"},"switchBackDelay"),", the Pulsar client switches back to the primary cluster.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"checkInterval")),(0,r.yg)("td",{parentName:"tr",align:null},"30s"),(0,r.yg)("td",{parentName:"tr",align:null},"No"),(0,r.yg)("td",{parentName:"tr",align:null},"Frequency of performing a probe task (in seconds).")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"secondaryTlsTrustCertsFilePath")),(0,r.yg)("td",{parentName:"tr",align:null},"N/A"),(0,r.yg)("td",{parentName:"tr",align:null},"No"),(0,r.yg)("td",{parentName:"tr",align:null},"A map of certificate file. Keys are service urls of backup cluster. Values are paths to the trusted TLS certificate file of the backup cluster.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"secondaryAuthentication")),(0,r.yg)("td",{parentName:"tr",align:null},"N/A"),(0,r.yg)("td",{parentName:"tr",align:null},"No"),(0,r.yg)("td",{parentName:"tr",align:null},"A map of Authentication config. Keys are service urls of backup cluster. Values are Authentication object of the backup cluster."))))),(0,r.yg)(i.A,{value:"Controlled cluster-level failover",mdxType:"TabItem"},(0,r.yg)("p",null,"This is an example of how to construct a Java Pulsar client to use controlled cluster-level failover. The switchover is triggered by administrators manually."),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Note"),": you can have one or several backup clusters but can only specify one."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'public PulsarClient getControlledFailoverClient() throws IOException {\n    Map<String, String> header = new HashMap();\n    header.put("service_user_id", "my-user");\n    header.put("service_password", "tiger");\n    header.put("clusterA", "tokenA");\n    header.put("clusterB", "tokenB");\n\n    ServiceUrlProvider provider = ControlledClusterFailover.builder()\n        .defaultServiceUrl("pulsar://localhost:6650")\n        .checkInterval(1, TimeUnit.MINUTES)\n        .urlProvider("http://localhost:8080/test")\n        .urlProviderHeader(header)\n        .build();\n\n    PulsarClient pulsarClient = PulsarClient.builder()\n        .serviceUrlProvider(provider)\n        .build();\n\n    provider.initialize(pulsarClient);\n    return pulsarClient;\n}\n')),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Parameter"),(0,r.yg)("th",{parentName:"tr",align:null},"Default value"),(0,r.yg)("th",{parentName:"tr",align:null},"Required?"),(0,r.yg)("th",{parentName:"tr",align:null},"Description"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"defaultServiceUrl")),(0,r.yg)("td",{parentName:"tr",align:null},"N/A"),(0,r.yg)("td",{parentName:"tr",align:null},"Yes"),(0,r.yg)("td",{parentName:"tr",align:null},"Pulsar service URL.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"checkInterval")),(0,r.yg)("td",{parentName:"tr",align:null},"30s"),(0,r.yg)("td",{parentName:"tr",align:null},"No"),(0,r.yg)("td",{parentName:"tr",align:null},"Frequency of performing a probe task (in seconds).")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"urlProvider")),(0,r.yg)("td",{parentName:"tr",align:null},"N/A"),(0,r.yg)("td",{parentName:"tr",align:null},"Yes"),(0,r.yg)("td",{parentName:"tr",align:null},"URL provider service.")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"urlProviderHeader")),(0,r.yg)("td",{parentName:"tr",align:null},"N/A"),(0,r.yg)("td",{parentName:"tr",align:null},"No"),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"urlProviderHeader")," is a map containing tokens and credentials. ",(0,r.yg)("br",null),(0,r.yg)("br",null),"If you enable authentication or authorization between Pulsar clients and primary and backup clusters, you need to provide ",(0,r.yg)("inlineCode",{parentName:"td"},"urlProviderHeader"),".")))),(0,r.yg)("p",null,"Here is an example of how ",(0,r.yg)("inlineCode",{parentName:"p"},"urlProviderHeader")," works."),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"How urlProviderHeader works",src:t(5153).A,width:"1350",height:"680"})),(0,r.yg)("p",null,"Assume that you want to connect Pulsar client 1 to cluster A."),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Pulsar client 1 sends the token ",(0,r.yg)("em",{parentName:"p"},"t1")," to the URL provider service.")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"The URL provider service returns the credential ",(0,r.yg)("em",{parentName:"p"},"c1")," and the cluster A URL to the Pulsar client."),(0,r.yg)("p",{parentName:"li"},"The URL provider service manages all tokens and credentials. It returns different credentials based on different tokens and different target cluster URLs to different Pulsar clients."),(0,r.yg)("p",{parentName:"li"},(0,r.yg)("strong",{parentName:"p"},"Note"),": ",(0,r.yg)("strong",{parentName:"p"},"the credential must be in a JSON file and contain parameters as shown"),"."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-java"},'{\n"serviceUrl": "pulsar+ssl://target:6651",\n"tlsTrustCertsFilePath": "/security/ca.cert.pem",\n"authPluginClassName":"org.apache.pulsar.client.impl.auth.AuthenticationTls",\n"authParamsString": " \\"tlsCertFile\\": \\"/security/client.cert.pem\\"\n    \\"tlsKeyFile\\": \\"/security/client-pk8.pem\\" "\n}\n'))),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"Pulsar client 1 connects to cluster A using credential ",(0,r.yg)("em",{parentName:"p"},"c1"),"."))))),(0,r.yg)("blockquote",null,(0,r.yg)("h4",{parentName:"blockquote",id:"how-does-cluster-level-failover-work"},"How does cluster-level failover work?")),(0,r.yg)("p",null,"This chapter explains the working process of cluster-level failover. For more implementation details, see ",(0,r.yg)("a",{parentName:"p",href:"https://github.com/apache/pulsar/issues/13315"},"PIP-121"),"."),(0,r.yg)(l.A,{defaultValue:"Automatic cluster-level failover",values:[{label:"Automatic cluster-level failover",value:"Automatic cluster-level failover"},{label:"Controlled cluster-level failover",value:"Controlled cluster-level failover"}],mdxType:"Tabs"},(0,r.yg)(i.A,{value:"Automatic cluster-level failover",mdxType:"TabItem"},(0,r.yg)("p",null,"In automatic failover cluster, the primary cluster and backup cluster are aware of each other's availability. The automatic failover cluster performs the following actions without administrator intervention:"),(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"The Pulsar client runs a probe task at intervals defined in ",(0,r.yg)("inlineCode",{parentName:"p"},"checkInterval"),".")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"If the probe task finds the failure time of the primary cluster exceeds the time set in the ",(0,r.yg)("inlineCode",{parentName:"p"},"failoverDelay")," parameter, it searches backup clusters for an available healthy cluster."),(0,r.yg)("p",{parentName:"li"},"2a) If there are healthy backup clusters, the Pulsar client switches to a backup cluster in the order defined in ",(0,r.yg)("inlineCode",{parentName:"p"},"secondary"),"."),(0,r.yg)("p",{parentName:"li"},"2b) If there is no healthy backup cluster, the Pulsar client does not perform the switchover, and the probe task continues to look  for an available backup cluster.")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"The probe task checks whether the primary cluster functions well or not."),(0,r.yg)("p",{parentName:"li"},"3a) If the primary cluster comes back and the continuous healthy time exceeds the time set in ",(0,r.yg)("inlineCode",{parentName:"p"},"switchBackDelay"),", the Pulsar client switches back to the primary cluster."),(0,r.yg)("p",{parentName:"li"},"3b) If the primary cluster does not come back, the Pulsar client does not perform the switchover."))),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Workflow of automatic failover cluster",src:t(6670).A,width:"1150",height:"1746"}))),(0,r.yg)(i.A,{value:"Controlled cluster-level failover",mdxType:"TabItem"},(0,r.yg)("ol",null,(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"The Pulsar client runs a probe task at intervals defined in ",(0,r.yg)("inlineCode",{parentName:"p"},"checkInterval"),".")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"The probe task fetches the service URL configuration from the URL provider service, which is configured by ",(0,r.yg)("inlineCode",{parentName:"p"},"urlProvider"),"."),(0,r.yg)("p",{parentName:"li"},"2a) If the service URL configuration is changed, the probe task  switches to the target cluster without checking the health status of the target cluster."),(0,r.yg)("p",{parentName:"li"},"2b) If the service URL configuration is not changed, the Pulsar client does not perform the switchover.")),(0,r.yg)("li",{parentName:"ol"},(0,r.yg)("p",{parentName:"li"},"If the Pulsar client switches to the target cluster, the probe task continues to fetch service URL configuration from the URL provider service at intervals defined in ",(0,r.yg)("inlineCode",{parentName:"p"},"checkInterval"),"."),(0,r.yg)("p",{parentName:"li"},"3a) If the service URL configuration is changed, the probe task  switches to the target cluster without checking the health status of the target cluster."),(0,r.yg)("p",{parentName:"li"},"3b) If the service URL configuration is not changed, it does not perform the switchover."))),(0,r.yg)("p",null,(0,r.yg)("img",{alt:"Workflow of controlled failover cluster",src:t(6167).A,width:"1066",height:"1292"})))),(0,r.yg)("h2",{id:"producer"},"Producer"),(0,r.yg)("p",null,"In Pulsar, producers write messages to topics. Once you've instantiated a ",(0,r.yg)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/2.10.x/org/apache/pulsar/client/api/PulsarClient"},"PulsarClient")," object (as in the section ",(0,r.yg)("a",{parentName:"p",href:"#client-configuration"},"above"),"), you can create a ",(0,r.yg)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/2.10.x/org/apache/pulsar/client/api/Producer"},"Producer")," for a specific Pulsar ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/reference-terminology#topic"},"topic"),"."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nProducer<byte[]> producer = client.newProducer()\n        .topic("my-topic")\n        .create();\n\n// You can then send messages to the broker and topic you specified:\nproducer.send("My message".getBytes());\n\n')),(0,r.yg)("p",null,"By default, producers produce messages that consist of byte arrays. You can produce different types by specifying a message ",(0,r.yg)("a",{parentName:"p",href:"#schema"},"schema"),"."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nProducer<String> stringProducer = client.newProducer(Schema.STRING)\n        .topic("my-topic")\n        .create();\nstringProducer.send("My message");\n\n')),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},"Make sure that you close your producers, consumers, and clients when you do not need them.")),(0,r.yg)("blockquote",null,(0,r.yg)("pre",{parentName:"blockquote"},(0,r.yg)("code",{parentName:"pre",className:"language-java"},"\nproducer.close();\nconsumer.close();\nclient.close();\n\n\n"))),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},"Close operations can also be asynchronous:")),(0,r.yg)("blockquote",null,(0,r.yg)("pre",{parentName:"blockquote"},(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nproducer.closeAsync()\n   .thenRun(() -> System.out.println("Producer closed"))\n   .exceptionally((ex) -> {\n       System.err.println("Failed to close producer: " + ex);\n       return null;\n   });\n\n\n'))),(0,r.yg)("h3",{id:"configure-producer"},"Configure producer"),(0,r.yg)("p",null,"If you instantiate a ",(0,r.yg)("inlineCode",{parentName:"p"},"Producer")," object by specifying only a topic name as the example above, the default configuration of producer is used."),(0,r.yg)("p",null,"If you create a producer, you can use the ",(0,r.yg)("inlineCode",{parentName:"p"},"loadConf")," configuration. The following parameters are available in ",(0,r.yg)("inlineCode",{parentName:"p"},"loadConf"),"."),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Name"),(0,r.yg)("th",{parentName:"tr",align:null},"Type"),(0,r.yg)("th",{parentName:"tr",align:null},(0,r.yg)("div",null,"Description")),(0,r.yg)("th",{parentName:"tr",align:null},"Default"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"topicName")),(0,r.yg)("td",{parentName:"tr",align:null},"string"),(0,r.yg)("td",{parentName:"tr",align:null},"Topic name"),(0,r.yg)("td",{parentName:"tr",align:null},"null")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"producerName")),(0,r.yg)("td",{parentName:"tr",align:null},"string"),(0,r.yg)("td",{parentName:"tr",align:null},"Producer name"),(0,r.yg)("td",{parentName:"tr",align:null},"null")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"sendTimeoutMs")),(0,r.yg)("td",{parentName:"tr",align:null},"long"),(0,r.yg)("td",{parentName:"tr",align:null},"Message send timeout in ms.",(0,r.yg)("br",null),"If a message is not acknowledged by a server before the ",(0,r.yg)("inlineCode",{parentName:"td"},"sendTimeout")," expires, an error occurs."),(0,r.yg)("td",{parentName:"tr",align:null},"30000")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"blockIfQueueFull")),(0,r.yg)("td",{parentName:"tr",align:null},"boolean"),(0,r.yg)("td",{parentName:"tr",align:null},"If it is set to ",(0,r.yg)("inlineCode",{parentName:"td"},"true"),", when the outgoing message queue is full, the ",(0,r.yg)("inlineCode",{parentName:"td"},"Send")," and ",(0,r.yg)("inlineCode",{parentName:"td"},"SendAsync")," methods of producer block, rather than failing and throwing errors. ",(0,r.yg)("br",null),"If it is set to ",(0,r.yg)("inlineCode",{parentName:"td"},"false"),", when the outgoing message queue is full, the ",(0,r.yg)("inlineCode",{parentName:"td"},"Send")," and ",(0,r.yg)("inlineCode",{parentName:"td"},"SendAsync")," methods of producer fail and ",(0,r.yg)("inlineCode",{parentName:"td"},"ProducerQueueIsFullError")," exceptions occur.",(0,r.yg)("br",null),(0,r.yg)("br",null),"The ",(0,r.yg)("inlineCode",{parentName:"td"},"MaxPendingMessages")," parameter determines the size of the outgoing message queue."),(0,r.yg)("td",{parentName:"tr",align:null},"false")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"maxPendingMessages")),(0,r.yg)("td",{parentName:"tr",align:null},"int"),(0,r.yg)("td",{parentName:"tr",align:null},"The maximum size of a queue holding pending messages.",(0,r.yg)("br",null),(0,r.yg)("br",null),"For example, a message waiting to receive an acknowledgment from a ",(0,r.yg)("a",{parentName:"td",href:"/docs/2.10.x/reference-terminology#broker"},"broker"),". ",(0,r.yg)("br",null),(0,r.yg)("br",null),"By default, when the queue is full, all calls to the ",(0,r.yg)("inlineCode",{parentName:"td"},"Send")," and ",(0,r.yg)("inlineCode",{parentName:"td"},"SendAsync")," methods fail ",(0,r.yg)("strong",{parentName:"td"},"unless")," you set ",(0,r.yg)("inlineCode",{parentName:"td"},"BlockIfQueueFull")," to ",(0,r.yg)("inlineCode",{parentName:"td"},"true"),"."),(0,r.yg)("td",{parentName:"tr",align:null},"1000")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"maxPendingMessagesAcrossPartitions")),(0,r.yg)("td",{parentName:"tr",align:null},"int"),(0,r.yg)("td",{parentName:"tr",align:null},"The maximum number of pending messages across partitions. ",(0,r.yg)("br",null),(0,r.yg)("br",null),"Use the setting to lower the max pending messages for each partition ({@link #setMaxPendingMessages(int)}) if the total number exceeds the configured value."),(0,r.yg)("td",{parentName:"tr",align:null},"50000")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"messageRoutingMode")),(0,r.yg)("td",{parentName:"tr",align:null},"MessageRoutingMode"),(0,r.yg)("td",{parentName:"tr",align:null},"Message routing logic for producers on ",(0,r.yg)("a",{parentName:"td",href:"/docs/2.10.x/concepts-architecture-overview#partitioned-topics"},"partitioned topics"),".",(0,r.yg)("br",null)," Apply the logic only when setting no key on messages. ",(0,r.yg)("br",null),"Available options are as follows: ",(0,r.yg)("br",null),(0,r.yg)("li",null,(0,r.yg)("inlineCode",{parentName:"td"},"pulsar.RoundRobinDistribution"),": round robin"),(0,r.yg)("li",null,(0,r.yg)("inlineCode",{parentName:"td"},"pulsar.UseSinglePartition"),": publish all messages to a single partition"),(0,r.yg)("li",null,(0,r.yg)("inlineCode",{parentName:"td"},"pulsar.CustomPartition"),": a custom partitioning scheme")),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("li",null,(0,r.yg)("inlineCode",{parentName:"td"},"pulsar.RoundRobinDistribution")))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"hashingScheme")),(0,r.yg)("td",{parentName:"tr",align:null},"HashingScheme"),(0,r.yg)("td",{parentName:"tr",align:null},"Hashing function determining the partition where you publish a particular message (",(0,r.yg)("strong",{parentName:"td"},"partitioned topics only"),").",(0,r.yg)("br",null),"Available options are as follows:",(0,r.yg)("br",null),(0,r.yg)("li",null," ",(0,r.yg)("inlineCode",{parentName:"td"},"pulsar.JavastringHash"),": the equivalent of ",(0,r.yg)("inlineCode",{parentName:"td"},"string.hashCode()")," in Java"),(0,r.yg)("li",null," ",(0,r.yg)("inlineCode",{parentName:"td"},"pulsar.Murmur3_32Hash"),": applies the ",(0,r.yg)("a",{parentName:"td",href:"https://en.wikipedia.org/wiki/MurmurHash"},"Murmur3")," hashing function"),(0,r.yg)("li",null,(0,r.yg)("inlineCode",{parentName:"td"},"pulsar.BoostHash"),": applies the hashing function from C++'s ",(0,r.yg)("a",{parentName:"td",href:"https://www.boost.org/doc/libs/1_62_0/doc/html/hash.html"},"Boost")," library")),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"HashingScheme.JavastringHash"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"cryptoFailureAction")),(0,r.yg)("td",{parentName:"tr",align:null},"ProducerCryptoFailureAction"),(0,r.yg)("td",{parentName:"tr",align:null},"Producer should take action when encryption fails.",(0,r.yg)("br",null),(0,r.yg)("li",null,(0,r.yg)("strong",{parentName:"td"},"FAIL"),": if encryption fails, unencrypted messages fail to send."),(0,r.yg)("li",null," ",(0,r.yg)("strong",{parentName:"td"},"SEND"),": if encryption fails, unencrypted messages are sent.")),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"ProducerCryptoFailureAction.FAIL"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"batchingMaxPublishDelayMicros")),(0,r.yg)("td",{parentName:"tr",align:null},"long"),(0,r.yg)("td",{parentName:"tr",align:null},"Batching time period of sending messages."),(0,r.yg)("td",{parentName:"tr",align:null},"TimeUnit.MILLISECONDS.toMicros(1)")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"batchingMaxMessages")),(0,r.yg)("td",{parentName:"tr",align:null},"int"),(0,r.yg)("td",{parentName:"tr",align:null},"The maximum number of messages permitted in a batch."),(0,r.yg)("td",{parentName:"tr",align:null},"1000")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"batchingEnabled")),(0,r.yg)("td",{parentName:"tr",align:null},"boolean"),(0,r.yg)("td",{parentName:"tr",align:null},"Enable batching of messages."),(0,r.yg)("td",{parentName:"tr",align:null},"true")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"chunkingEnabled")),(0,r.yg)("td",{parentName:"tr",align:null},"boolean"),(0,r.yg)("td",{parentName:"tr",align:null},"Enable chunking of messages."),(0,r.yg)("td",{parentName:"tr",align:null},"false")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"compressionType")),(0,r.yg)("td",{parentName:"tr",align:null},"CompressionType"),(0,r.yg)("td",{parentName:"tr",align:null},"Message data compression type used by a producer. ",(0,r.yg)("br",null),"Available options:",(0,r.yg)("li",null,(0,r.yg)("a",{parentName:"td",href:"https://github.com/lz4/lz4"},(0,r.yg)("inlineCode",{parentName:"a"},"LZ4"))),(0,r.yg)("li",null,(0,r.yg)("a",{parentName:"td",href:"https://zlib.net/"},(0,r.yg)("inlineCode",{parentName:"a"},"ZLIB")),(0,r.yg)("br",null)),(0,r.yg)("li",null,(0,r.yg)("a",{parentName:"td",href:"https://facebook.github.io/zstd/"},(0,r.yg)("inlineCode",{parentName:"a"},"ZSTD"))),(0,r.yg)("li",null,(0,r.yg)("a",{parentName:"td",href:"https://google.github.io/snappy/"},(0,r.yg)("inlineCode",{parentName:"a"},"SNAPPY")))),(0,r.yg)("td",{parentName:"tr",align:null},"No compression")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"initialSubscriptionName")),(0,r.yg)("td",{parentName:"tr",align:null},"string"),(0,r.yg)("td",{parentName:"tr",align:null},"Use this configuration to automatically create an initial subscription when creating a topic. If this field is not set, the initial subscription is not created."),(0,r.yg)("td",{parentName:"tr",align:null},"null")))),(0,r.yg)("p",null,"You can configure parameters if you do not want to use the default configuration."),(0,r.yg)("p",null,"For a full list, see the Javadoc for the ",(0,r.yg)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/2.10.x/org/apache/pulsar/client/api/ProducerBuilder"},"ProducerBuilder")," class. The following is an example."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nProducer<byte[]> producer = client.newProducer()\n    .topic("my-topic")\n    .batchingMaxPublishDelay(10, TimeUnit.MILLISECONDS)\n    .sendTimeout(10, TimeUnit.SECONDS)\n    .blockIfQueueFull(true)\n    .create();\n\n')),(0,r.yg)("h3",{id:"message-routing"},"Message routing"),(0,r.yg)("p",null,"When using partitioned topics, you can specify the routing mode whenever you publish messages using a producer. For more information on specifying a routing mode using the Java client, see the ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/cookbooks-partitioned"},"Partitioned Topics cookbook"),"."),(0,r.yg)("h3",{id:"async-send"},"Async send"),(0,r.yg)("p",null,"You can publish messages ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/concepts-messaging#send-modes"},"asynchronously")," using the Java client. With async send, the producer puts the message in a blocking queue and returns it immediately. Then the client library sends the message to the broker in the background. If the queue is full (max size configurable), the producer is blocked or fails immediately when calling the API, depending on arguments passed to the producer."),(0,r.yg)("p",null,"The following is an example."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nproducer.sendAsync("my-async-message".getBytes()).thenAccept(msgId -> {\n    System.out.println("Message with ID " + msgId + " successfully sent");\n});\n\n')),(0,r.yg)("p",null,"As you can see from the example above, async send operations return a ",(0,r.yg)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/2.10.x/org/apache/pulsar/client/api/MessageId"},"MessageId")," wrapped in a ",(0,r.yg)("a",{parentName:"p",href:"http://www.baeldung.com/java-completablefuture"},(0,r.yg)("inlineCode",{parentName:"a"},"CompletableFuture")),"."),(0,r.yg)("h3",{id:"configure-messages"},"Configure messages"),(0,r.yg)("p",null,"In addition to a value, you can set additional items on a given message:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nproducer.newMessage()\n    .key("my-message-key")\n    .value("my-async-message".getBytes())\n    .property("my-key", "my-value")\n    .property("my-other-key", "my-other-value")\n    .send();\n\n')),(0,r.yg)("p",null,"You can terminate the builder chain with ",(0,r.yg)("inlineCode",{parentName:"p"},"sendAsync()")," and get a future return."),(0,r.yg)("h3",{id:"enable-chunking"},"Enable chunking"),(0,r.yg)("p",null,"Message ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/concepts-messaging#chunking"},"chunking")," enables Pulsar to process large payload messages by splitting the message into chunks at the producer side and aggregating chunked messages at the consumer side."),(0,r.yg)("p",null,"The message chunking feature is OFF by default. The following is an example about how to enable message chunking when creating a producer."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},"\nProducer<byte[]> producer = client.newProducer()\n        .topic(topic)\n        .enableChunking(true)\n        .enableBatching(false)\n        .create();\n\n")),(0,r.yg)("p",null,"By default, producer chunks the large message based on max message size (",(0,r.yg)("inlineCode",{parentName:"p"},"maxMessageSize"),") configured at broker (eg: 5MB). However, client can also configure max chunked size using producer configuration ",(0,r.yg)("inlineCode",{parentName:"p"},"chunkMaxMessageSize"),"."),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},(0,r.yg)("strong",{parentName:"p"},"Note:")," To enable chunking, you need to disable batching (",(0,r.yg)("inlineCode",{parentName:"p"},"enableBatching"),"=",(0,r.yg)("inlineCode",{parentName:"p"},"false"),") concurrently.")),(0,r.yg)("h3",{id:"intercept-messages"},"Intercept messages"),(0,r.yg)("p",null,(0,r.yg)("inlineCode",{parentName:"p"},"ProducerInterceptor"),"s intercept and possibly mutate messages received by the producer before they are published to the brokers."),(0,r.yg)("p",null,"The interface has three main events:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"eligible")," checks if the interceptor can be applied to the message."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"beforeSend")," is triggered before the producer sends the message to the broker. You can modify messages within this event."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"onSendAcknowledgement")," is triggered when the message is acknowledged by the broker or the sending failed.")),(0,r.yg)("p",null,"To intercept messages, you can add one or multiple ",(0,r.yg)("inlineCode",{parentName:"p"},"ProducerInterceptor"),"s when creating a ",(0,r.yg)("inlineCode",{parentName:"p"},"Producer")," as follows."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},"\nProducer<byte[]> producer = client.newProducer()\n        .topic(topic)\n        .intercept(new ProducerInterceptor {\n            @Override\n            boolean eligible(Message message) {\n                return true;  // process all messages\n            }\n\n            @Override\n            Message beforeSend(Producer producer, Message message) {\n                // user-defined processing logic\n            }\n\n            @Override\n            void onSendAcknowledgement(Producer producer, Message message, MessageId msgId, Throwable exception) {\n                // user-defined processing logic\n            }\n        })\n        .create();\n\n")),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"If you are using multiple interceptors, they apply in the order they are passed to the ",(0,r.yg)("inlineCode",{parentName:"p"},"intercept")," method.")),(0,r.yg)("h2",{id:"consumer"},"Consumer"),(0,r.yg)("p",null,"In Pulsar, consumers subscribe to topics and handle messages that producers publish to those topics. You can instantiate a new ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/reference-terminology#consumer"},"consumer")," by first instantiating a ",(0,r.yg)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/2.10.x/org/apache/pulsar/client/api/PulsarClient"},"PulsarClient")," object and passing it a URL for a Pulsar broker (as ",(0,r.yg)("a",{parentName:"p",href:"#client-configuration"},"above"),")."),(0,r.yg)("p",null,"Once you've instantiated a ",(0,r.yg)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/2.10.x/org/apache/pulsar/client/api/PulsarClient"},"PulsarClient")," object, you can create a ",(0,r.yg)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/2.10.x/org/apache/pulsar/client/api/Consumer"},"Consumer")," by specifying a ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/reference-terminology#topic"},"topic")," and a ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/concepts-messaging#subscription-types"},"subscription"),"."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nConsumer consumer = client.newConsumer()\n        .topic("my-topic")\n        .subscriptionName("my-subscription")\n        .subscribe();\n\n')),(0,r.yg)("p",null,"The ",(0,r.yg)("inlineCode",{parentName:"p"},"subscribe")," method will auto subscribe the consumer to the specified topic and subscription. One way to make the consumer listen on the topic is to set up a ",(0,r.yg)("inlineCode",{parentName:"p"},"while")," loop. In this example loop, the consumer listens for messages, prints the contents of any received message, and then ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/reference-terminology#acknowledgment-ack"},"acknowledges")," that the message has been processed. If the processing logic fails, you can use ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/reference-terminology#acknowledgment-ack"},"negative acknowledgement")," to redeliver the message later."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nwhile (true) {\n  // Wait for a message\n  Message msg = consumer.receive();\n\n  try {\n      // Do something with the message\n      System.out.println("Message received: " + new String(msg.getData()));\n\n      // Acknowledge the message\n      consumer.acknowledge(msg);\n  } catch (Exception e) {\n      // Message failed to process, redeliver later\n      consumer.negativeAcknowledge(msg);\n  }\n}\n\n')),(0,r.yg)("p",null,"If you don't want to block your main thread but constantly listen for new messages, consider using a ",(0,r.yg)("inlineCode",{parentName:"p"},"MessageListener"),". The ",(0,r.yg)("inlineCode",{parentName:"p"},"MessageListener")," uses a thread pool inside the client. You can set the number of threads for message listeners in the ClientBuilder."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nMessageListener myMessageListener = (consumer, msg) -> {\n  try {\n      System.out.println("Message received: " + new String(msg.getData()));\n      consumer.acknowledge(msg);\n  } catch (Exception e) {\n      consumer.negativeAcknowledge(msg);\n  }\n}\n\nConsumer consumer = client.newConsumer()\n     .topic("my-topic")\n     .subscriptionName("my-subscription")\n     .messageListener(myMessageListener)\n     .subscribe();\n\n')),(0,r.yg)("h3",{id:"configure-consumer"},"Configure consumer"),(0,r.yg)("p",null,"If you instantiate a ",(0,r.yg)("inlineCode",{parentName:"p"},"Consumer")," object by specifying only a topic and subscription name as in the example above, the consumer uses the default configuration."),(0,r.yg)("p",null,"When you create a consumer, you can use the ",(0,r.yg)("inlineCode",{parentName:"p"},"loadConf")," configuration. The following parameters are available in ",(0,r.yg)("inlineCode",{parentName:"p"},"loadConf"),"."),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Name"),(0,r.yg)("th",{parentName:"tr",align:null},"Type"),(0,r.yg)("th",{parentName:"tr",align:null},(0,r.yg)("div",null,"Description")),(0,r.yg)("th",{parentName:"tr",align:null},"Default"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"topicNames")),(0,r.yg)("td",{parentName:"tr",align:null},"Set","<","String",">"),(0,r.yg)("td",{parentName:"tr",align:null},"Topic name"),(0,r.yg)("td",{parentName:"tr",align:null},"Sets.newTreeSet()")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"topicsPattern")),(0,r.yg)("td",{parentName:"tr",align:null},"Pattern"),(0,r.yg)("td",{parentName:"tr",align:null},"Topic pattern"),(0,r.yg)("td",{parentName:"tr",align:null},"None")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"subscriptionName")),(0,r.yg)("td",{parentName:"tr",align:null},"String"),(0,r.yg)("td",{parentName:"tr",align:null},"Subscription name"),(0,r.yg)("td",{parentName:"tr",align:null},"None")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"subscriptionType")),(0,r.yg)("td",{parentName:"tr",align:null},"SubscriptionType"),(0,r.yg)("td",{parentName:"tr",align:null},"Subscription type ",(0,r.yg)("br",null),"Four subscription types are available:",(0,r.yg)("li",null,"Exclusive"),(0,r.yg)("li",null,"Failover"),(0,r.yg)("li",null,"Shared"),(0,r.yg)("li",null,"Key_Shared")),(0,r.yg)("td",{parentName:"tr",align:null},"SubscriptionType.Exclusive")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"receiverQueueSize")),(0,r.yg)("td",{parentName:"tr",align:null},"int"),(0,r.yg)("td",{parentName:"tr",align:null},"Size of a consumer's receiver queue. ",(0,r.yg)("br",null),(0,r.yg)("br",null),"For example, the number of messages accumulated by a consumer before an application calls ",(0,r.yg)("inlineCode",{parentName:"td"},"Receive"),". ",(0,r.yg)("br",null),(0,r.yg)("br",null),"A value higher than the default value increases consumer throughput, though at the expense of more memory utilization."),(0,r.yg)("td",{parentName:"tr",align:null},"1000")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"acknowledgementsGroupTimeMicros")),(0,r.yg)("td",{parentName:"tr",align:null},"long"),(0,r.yg)("td",{parentName:"tr",align:null},"Group a consumer acknowledgment for a specified time.",(0,r.yg)("br",null),(0,r.yg)("br",null),"By default, a consumer uses 100ms grouping time to send out acknowledgments to a broker.",(0,r.yg)("br",null),(0,r.yg)("br",null),"Setting a group time of 0 sends out acknowledgments immediately. ",(0,r.yg)("br",null),(0,r.yg)("br",null),"A longer ack group time is more efficient at the expense of a slight increase in message re-deliveries after a failure."),(0,r.yg)("td",{parentName:"tr",align:null},"TimeUnit.MILLISECONDS.toMicros(100)")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"negativeAckRedeliveryDelayMicros")),(0,r.yg)("td",{parentName:"tr",align:null},"long"),(0,r.yg)("td",{parentName:"tr",align:null},"Delay to wait before redelivering messages that failed to be processed.",(0,r.yg)("br",null),(0,r.yg)("br",null)," When an application uses {@link Consumer#negativeAcknowledge(Message)}, failed messages are redelivered after a fixed timeout."),(0,r.yg)("td",{parentName:"tr",align:null},"TimeUnit.MINUTES.toMicros(1)")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"maxTotalReceiverQueueSizeAcrossPartitions")),(0,r.yg)("td",{parentName:"tr",align:null},"int"),(0,r.yg)("td",{parentName:"tr",align:null},"The max total receiver queue size across partitions.",(0,r.yg)("br",null),(0,r.yg)("br",null),"This setting reduces the receiver queue size for individual partitions if the total receiver queue size exceeds this value."),(0,r.yg)("td",{parentName:"tr",align:null},"50000")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"consumerName")),(0,r.yg)("td",{parentName:"tr",align:null},"String"),(0,r.yg)("td",{parentName:"tr",align:null},"Consumer name"),(0,r.yg)("td",{parentName:"tr",align:null},"null")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"ackTimeoutMillis")),(0,r.yg)("td",{parentName:"tr",align:null},"long"),(0,r.yg)("td",{parentName:"tr",align:null},"Timeout of unacked messages"),(0,r.yg)("td",{parentName:"tr",align:null},"0")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"tickDurationMillis")),(0,r.yg)("td",{parentName:"tr",align:null},"long"),(0,r.yg)("td",{parentName:"tr",align:null},"Granularity of the ack-timeout redelivery.",(0,r.yg)("br",null),(0,r.yg)("br",null),"Using an higher ",(0,r.yg)("inlineCode",{parentName:"td"},"tickDurationMillis")," reduces the memory overhead to track messages when setting ack-timeout to a bigger value (for example, 1 hour)."),(0,r.yg)("td",{parentName:"tr",align:null},"1000")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"priorityLevel")),(0,r.yg)("td",{parentName:"tr",align:null},"int"),(0,r.yg)("td",{parentName:"tr",align:null},"Priority level for a consumer to which a broker gives more priority while dispatching messages in Shared subscription type. ",(0,r.yg)("br",null),(0,r.yg)("br",null),"The broker follows descending priorities. For example, 0=max-priority, 1, 2,...",(0,r.yg)("br",null),(0,r.yg)("br",null),"In Shared subscription type, the broker ",(0,r.yg)("strong",{parentName:"td"},"first dispatches messages to the max priority level consumers if they have permits"),". Otherwise, the broker considers next priority level consumers.",(0,r.yg)("br",null),(0,r.yg)("br",null)," ",(0,r.yg)("strong",{parentName:"td"},"Example 1"),(0,r.yg)("br",null),"If a subscription has consumerA with ",(0,r.yg)("inlineCode",{parentName:"td"},"priorityLevel")," 0 and consumerB with ",(0,r.yg)("inlineCode",{parentName:"td"},"priorityLevel")," 1, then the broker ",(0,r.yg)("strong",{parentName:"td"},"only dispatches messages to consumerA until it runs out permits")," and then starts dispatching messages to consumerB.",(0,r.yg)("br",null),(0,r.yg)("br",null),(0,r.yg)("strong",{parentName:"td"},"Example 2"),(0,r.yg)("br",null),"Consumer Priority, Level, Permits",(0,r.yg)("br",null),"C1, 0, 2",(0,r.yg)("br",null),"C2, 0, 1",(0,r.yg)("br",null),"C3, 0, 1",(0,r.yg)("br",null),"C4, 1, 2",(0,r.yg)("br",null),"C5, 1, 1",(0,r.yg)("br",null),(0,r.yg)("br",null),"Order in which a broker dispatches messages to consumers is: C1, C2, C3, C1, C4, C5, C4."),(0,r.yg)("td",{parentName:"tr",align:null},"0")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"cryptoFailureAction")),(0,r.yg)("td",{parentName:"tr",align:null},"ConsumerCryptoFailureAction"),(0,r.yg)("td",{parentName:"tr",align:null},"Consumer should take action when it receives a message that can not be decrypted.",(0,r.yg)("br",null),(0,r.yg)("li",null,(0,r.yg)("strong",{parentName:"td"},"FAIL"),": this is the default option to fail messages until crypto succeeds."),(0,r.yg)("li",null," ",(0,r.yg)("strong",{parentName:"td"},"DISCARD"),":silently acknowledge and not deliver message to an application."),(0,r.yg)("li",null,(0,r.yg)("strong",{parentName:"td"},"CONSUME"),": deliver encrypted messages to applications. It is the application's responsibility to decrypt the message."),(0,r.yg)("br",null),"The decompression of message fails. ",(0,r.yg)("br",null),(0,r.yg)("br",null),"If messages contain batch messages, a client is not be able to retrieve individual messages in batch.",(0,r.yg)("br",null),(0,r.yg)("br",null),"Delivered encrypted message contains {@link EncryptionContext} which contains encryption and compression information in it using which application can decrypt consumed message payload."),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("li",null,"ConsumerCryptoFailureAction.FAIL"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"properties")),(0,r.yg)("td",{parentName:"tr",align:null},"SortedMap<String, String>"),(0,r.yg)("td",{parentName:"tr",align:null},"A name or value property of this consumer.",(0,r.yg)("br",null),(0,r.yg)("br",null),(0,r.yg)("inlineCode",{parentName:"td"},"properties")," is application defined metadata attached to a consumer. ",(0,r.yg)("br",null),(0,r.yg)("br",null),"When getting a topic stats, associate this metadata with the consumer stats for easier identification."),(0,r.yg)("td",{parentName:"tr",align:null},"new TreeMap()")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"readCompacted")),(0,r.yg)("td",{parentName:"tr",align:null},"boolean"),(0,r.yg)("td",{parentName:"tr",align:null},"If enabling ",(0,r.yg)("inlineCode",{parentName:"td"},"readCompacted"),", a consumer reads messages from a compacted topic rather than reading a full message backlog of a topic.",(0,r.yg)("br",null),(0,r.yg)("br",null)," A consumer only sees the latest value for each key in the compacted topic, up until reaching the point in the topic message when compacting backlog. Beyond that point, send messages as normal.",(0,r.yg)("br",null),(0,r.yg)("br",null),"Only enabling ",(0,r.yg)("inlineCode",{parentName:"td"},"readCompacted")," on subscriptions to persistent topics, which have a single active consumer (like failure or exclusive subscriptions). ",(0,r.yg)("br",null),(0,r.yg)("br",null),"Attempting to enable it on subscriptions to non-persistent topics or on shared subscriptions leads to a subscription call throwing a ",(0,r.yg)("inlineCode",{parentName:"td"},"PulsarClientException"),"."),(0,r.yg)("td",{parentName:"tr",align:null},"false")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"subscriptionInitialPosition")),(0,r.yg)("td",{parentName:"tr",align:null},"SubscriptionInitialPosition"),(0,r.yg)("td",{parentName:"tr",align:null},"Initial position at which to set cursor when subscribing to a topic at first time."),(0,r.yg)("td",{parentName:"tr",align:null},"SubscriptionInitialPosition.Latest")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"patternAutoDiscoveryPeriod")),(0,r.yg)("td",{parentName:"tr",align:null},"int"),(0,r.yg)("td",{parentName:"tr",align:null},"Topic auto discovery period when using a pattern for topic's consumer.",(0,r.yg)("br",null),(0,r.yg)("br",null),"The default and minimum value is 1 minute."),(0,r.yg)("td",{parentName:"tr",align:null},"1")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"regexSubscriptionMode")),(0,r.yg)("td",{parentName:"tr",align:null},"RegexSubscriptionMode"),(0,r.yg)("td",{parentName:"tr",align:null},"When subscribing to a topic using a regular expression, you can pick a certain type of topics.",(0,r.yg)("br",null),(0,r.yg)("br",null),(0,r.yg)("li",null,(0,r.yg)("strong",{parentName:"td"},"PersistentOnly"),": only subscribe to persistent topics."),(0,r.yg)("li",null,(0,r.yg)("strong",{parentName:"td"},"NonPersistentOnly"),": only subscribe to non-persistent topics."),(0,r.yg)("li",null,(0,r.yg)("strong",{parentName:"td"},"AllTopics"),": subscribe to both persistent and non-persistent topics.")),(0,r.yg)("td",{parentName:"tr",align:null},"RegexSubscriptionMode.PersistentOnly")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"deadLetterPolicy")),(0,r.yg)("td",{parentName:"tr",align:null},"DeadLetterPolicy"),(0,r.yg)("td",{parentName:"tr",align:null},"Dead letter policy for consumers.",(0,r.yg)("br",null),(0,r.yg)("br",null),"By default, some messages are probably redelivered many times, even to the extent that it never stops.",(0,r.yg)("br",null),(0,r.yg)("br",null),"By using the dead letter mechanism, messages have the max redelivery count. ",(0,r.yg)("strong",{parentName:"td"},"When exceeding the maximum number of redeliveries, messages are sent to the Dead Letter Topic and acknowledged automatically"),".",(0,r.yg)("br",null),(0,r.yg)("br",null),"You can enable the dead letter mechanism by setting ",(0,r.yg)("inlineCode",{parentName:"td"},"deadLetterPolicy"),".",(0,r.yg)("br",null),(0,r.yg)("br",null),(0,r.yg)("strong",{parentName:"td"},"Example"),(0,r.yg)("br",null),(0,r.yg)("br",null),(0,r.yg)("code",null,"client.newConsumer()",(0,r.yg)("br",null),".deadLetterPolicy(DeadLetterPolicy.builder().maxRedeliverCount(10).build())",(0,r.yg)("br",null),".subscribe();"),(0,r.yg)("br",null),(0,r.yg)("br",null),"Default dead letter topic name is ",(0,r.yg)("inlineCode",{parentName:"td"},"{TopicName}-{Subscription}-DLQ"),".",(0,r.yg)("br",null),(0,r.yg)("br",null),"To set a custom dead letter topic name:",(0,r.yg)("br",null),(0,r.yg)("code",null,"client.newConsumer()",(0,r.yg)("br",null),".deadLetterPolicy(DeadLetterPolicy.builder().maxRedeliverCount(10)",(0,r.yg)("br",null),'.deadLetterTopic("your-topic-name").build())',(0,r.yg)("br",null),".subscribe();"),(0,r.yg)("br",null),(0,r.yg)("br",null),"When specifying the dead letter policy while not specifying ",(0,r.yg)("inlineCode",{parentName:"td"},"ackTimeoutMillis"),", you can set the ack timeout to 30000 millisecond."),(0,r.yg)("td",{parentName:"tr",align:null},"None")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"autoUpdatePartitions")),(0,r.yg)("td",{parentName:"tr",align:null},"boolean"),(0,r.yg)("td",{parentName:"tr",align:null},"If ",(0,r.yg)("inlineCode",{parentName:"td"},"autoUpdatePartitions")," is enabled, a consumer subscribes to partition increasement automatically.",(0,r.yg)("br",null),(0,r.yg)("br",null),(0,r.yg)("strong",{parentName:"td"},"Note"),": this is only for partitioned consumers."),(0,r.yg)("td",{parentName:"tr",align:null},"true")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"replicateSubscriptionState")),(0,r.yg)("td",{parentName:"tr",align:null},"boolean"),(0,r.yg)("td",{parentName:"tr",align:null},"If ",(0,r.yg)("inlineCode",{parentName:"td"},"replicateSubscriptionState")," is\xa0enabled, a subscription state is replicated to geo-replicated clusters."),(0,r.yg)("td",{parentName:"tr",align:null},"false")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"negativeAckRedeliveryBackoff")),(0,r.yg)("td",{parentName:"tr",align:null},"RedeliveryBackoff"),(0,r.yg)("td",{parentName:"tr",align:null},"Interface for custom message is negativeAcked policy. You can specify ",(0,r.yg)("inlineCode",{parentName:"td"},"RedeliveryBackoff")," for a consumer."),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"MultiplierRedeliveryBackoff"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"ackTimeoutRedeliveryBackoff")),(0,r.yg)("td",{parentName:"tr",align:null},"RedeliveryBackoff"),(0,r.yg)("td",{parentName:"tr",align:null},"Interface for custom message is ackTimeout policy. You can specify ",(0,r.yg)("inlineCode",{parentName:"td"},"RedeliveryBackoff")," for a consumer."),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"MultiplierRedeliveryBackoff"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"autoAckOldestChunkedMessageOnQueueFull")),(0,r.yg)("td",{parentName:"tr",align:null},"boolean"),(0,r.yg)("td",{parentName:"tr",align:null},"Whether to automatically acknowledge pending chunked messages when the threashold of ",(0,r.yg)("inlineCode",{parentName:"td"},"maxPendingChunkedMessage")," is reached. If set to ",(0,r.yg)("inlineCode",{parentName:"td"},"false"),", these messages will be redelivered by their broker."),(0,r.yg)("td",{parentName:"tr",align:null},"true")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"maxPendingChunkedMessage")),(0,r.yg)("td",{parentName:"tr",align:null},"int"),(0,r.yg)("td",{parentName:"tr",align:null},"The maximum size of a queue holding pending chunked messages. When the threshold is reached, the consumer drops pending messages to optimize memory utilization."),(0,r.yg)("td",{parentName:"tr",align:null},"10")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"expireTimeOfIncompleteChunkedMessageMillis")),(0,r.yg)("td",{parentName:"tr",align:null},"long"),(0,r.yg)("td",{parentName:"tr",align:null},"The time interval to expire incomplete chunks if a consumer fails to receive all the chunks in the specified time period. The default value is 1 minute."),(0,r.yg)("td",{parentName:"tr",align:null},"60000")))),(0,r.yg)("p",null,"You can configure parameters if you do not want to use the default configuration. For a full list, see the Javadoc for the ",(0,r.yg)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/2.10.x/org/apache/pulsar/client/api/ConsumerBuilder"},"ConsumerBuilder")," class."),(0,r.yg)("p",null,"The following is an example."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nConsumer consumer = client.newConsumer()\n        .topic("my-topic")\n        .subscriptionName("my-subscription")\n        .ackTimeout(10, TimeUnit.SECONDS)\n        .subscriptionType(SubscriptionType.Exclusive)\n        .subscribe();\n\n')),(0,r.yg)("h3",{id:"async-receive"},"Async receive"),(0,r.yg)("p",null,"The ",(0,r.yg)("inlineCode",{parentName:"p"},"receive")," method receives messages synchronously (the consumer process is blocked until a message is available). You can also use ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/concepts-messaging#receive-modes"},"async receive"),", which returns a ",(0,r.yg)("a",{parentName:"p",href:"http://www.baeldung.com/java-completablefuture"},(0,r.yg)("inlineCode",{parentName:"a"},"CompletableFuture"))," object immediately once a new message is available."),(0,r.yg)("p",null,"The following is an example."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},"\nCompletableFuture<Message> asyncMessage = consumer.receiveAsync();\n\n")),(0,r.yg)("p",null,"Async receive operations return a ",(0,r.yg)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/2.10.x/org/apache/pulsar/client/api/Message"},"Message")," wrapped inside of a ",(0,r.yg)("a",{parentName:"p",href:"http://www.baeldung.com/java-completablefuture"},(0,r.yg)("inlineCode",{parentName:"a"},"CompletableFuture")),"."),(0,r.yg)("h3",{id:"batch-receive"},"Batch receive"),(0,r.yg)("p",null,"Use ",(0,r.yg)("inlineCode",{parentName:"p"},"batchReceive")," to receive multiple messages for each call."),(0,r.yg)("p",null,"The following is an example."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},"\nMessages messages = consumer.batchReceive();\nfor (Object message : messages) {\n  // do something\n}\nconsumer.acknowledge(messages)\n\n")),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"Batch receive policy limits the number and bytes of messages in a single batch. You can specify a timeout to wait for enough messages.\nThe batch receive is completed if any of the following conditions are met: enough number of messages, bytes of messages, wait timeout."),(0,r.yg)("pre",{parentName:"admonition"},(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nConsumer consumer = client.newConsumer()\n.topic("my-topic")\n.subscriptionName("my-subscription")\n.batchReceivePolicy(BatchReceivePolicy.builder()\n.maxNumMessages(100)\n.maxNumBytes(1024 * 1024)\n.timeout(200, TimeUnit.MILLISECONDS)\n.build())\n.subscribe();\n\n')),(0,r.yg)("p",{parentName:"admonition"},"The default batch receive policy is:"),(0,r.yg)("pre",{parentName:"admonition"},(0,r.yg)("code",{parentName:"pre",className:"language-java"},"\nBatchReceivePolicy.builder()\n.maxNumMessage(-1)\n.maxNumBytes(10 * 1024 * 1024)\n.timeout(100, TimeUnit.MILLISECONDS)\n.build();\n\n"))),(0,r.yg)("h3",{id:"configure-chunking"},"Configure chunking"),(0,r.yg)("p",null,"You can limit the maximum number of chunked messages a consumer maintains concurrently by configuring the ",(0,r.yg)("inlineCode",{parentName:"p"},"maxPendingChunkedMessage")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"autoAckOldestChunkedMessageOnQueueFull")," parameters. When the threshold is reached, the consumer drops pending messages by silently acknowledging them or asking the broker to redeliver them later. The ",(0,r.yg)("inlineCode",{parentName:"p"},"expireTimeOfIncompleteChunkedMessage")," parameter decides the time interval to expire incomplete chunks if the consumer fails to receive all chunks of a message within the specified time period."),(0,r.yg)("p",null,"The following is an example of how to configure message chunking."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nConsumer<byte[]> consumer = client.newConsumer()\n        .topic(topic)\n        .subscriptionName("test")\n        .autoAckOldestChunkedMessageOnQueueFull(true)\n        .maxPendingChunkedMessage(100)\n        .expireTimeOfIncompleteChunkedMessage(10, TimeUnit.MINUTES)\n        .subscribe();\n\n')),(0,r.yg)("h3",{id:"negative-acknowledgment-redelivery-backoff"},"Negative acknowledgment redelivery backoff"),(0,r.yg)("p",null,"The ",(0,r.yg)("inlineCode",{parentName:"p"},"RedeliveryBackoff")," introduces a redelivery backoff mechanism. You can achieve redelivery with different delays by setting ",(0,r.yg)("inlineCode",{parentName:"p"},"redeliveryCount ")," of messages."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nConsumer consumer =  client.newConsumer()\n        .topic("my-topic")\n        .subscriptionName("my-subscription")\n        .negativeAckRedeliveryBackoff(MultiplierRedeliveryBackoff.builder()\n                .minDelayMs(1000)\n                .maxDelayMs(60 * 1000)\n                .build())\n        .subscribe();\n\n')),(0,r.yg)("h3",{id:"acknowledgement-timeout-redelivery-backoff"},"Acknowledgement timeout redelivery backoff"),(0,r.yg)("p",null,"The ",(0,r.yg)("inlineCode",{parentName:"p"},"RedeliveryBackoff")," introduces a redelivery backoff mechanism. You can redeliver messages with different delays by setting the number\nof times the messages is retried."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nConsumer consumer =  client.newConsumer()\n        .topic("my-topic")\n        .subscriptionName("my-subscription")\n        .ackTimeout(10, TimeUnit.SECOND)\n        .ackTimeoutRedeliveryBackoff(MultiplierRedeliveryBackoff.builder()\n                .minDelayMs(1000)\n                .maxDelayMs(60000)\n                .multiplier(2)\n                .build())\n        .subscribe();\n\n')),(0,r.yg)("p",null,"The message redelivery behavior should be as follows."),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:"left"},"Redelivery count"),(0,r.yg)("th",{parentName:"tr",align:"left"},"Redelivery delay"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"1"),(0,r.yg)("td",{parentName:"tr",align:"left"},"10 + 1 seconds")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"2"),(0,r.yg)("td",{parentName:"tr",align:"left"},"10 + 2 seconds")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"3"),(0,r.yg)("td",{parentName:"tr",align:"left"},"10 + 4 seconds")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"4"),(0,r.yg)("td",{parentName:"tr",align:"left"},"10 + 8 seconds")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"5"),(0,r.yg)("td",{parentName:"tr",align:"left"},"10 + 16 seconds")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"6"),(0,r.yg)("td",{parentName:"tr",align:"left"},"10 + 32 seconds")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"7"),(0,r.yg)("td",{parentName:"tr",align:"left"},"10 + 60 seconds")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:"left"},"8"),(0,r.yg)("td",{parentName:"tr",align:"left"},"10 + 60 seconds")))),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("ul",{parentName:"admonition"},(0,r.yg)("li",{parentName:"ul"},"The ",(0,r.yg)("inlineCode",{parentName:"li"},"negativeAckRedeliveryBackoff")," does not work with ",(0,r.yg)("inlineCode",{parentName:"li"},"consumer.negativeAcknowledge(MessageId messageId)")," because you are not able to get the redelivery count from the message ID."),(0,r.yg)("li",{parentName:"ul"},"If a consumer crashes, it triggers the redelivery of unacked messages. In this case, ",(0,r.yg)("inlineCode",{parentName:"li"},"RedeliveryBackoff")," does not take effect and the messages might get redelivered earlier than the delay time from the backoff."))),(0,r.yg)("h3",{id:"multi-topic-subscriptions"},"Multi-topic subscriptions"),(0,r.yg)("p",null,"In addition to subscribing a consumer to a single Pulsar topic, you can also subscribe to multiple topics simultaneously using ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/concepts-messaging#multi-topic-subscriptions"},"multi-topic subscriptions"),". To use multi-topic subscriptions you can supply either a regular expression (regex) or a ",(0,r.yg)("inlineCode",{parentName:"p"},"List")," of topics. If you select topics via regex, all topics must be within the same Pulsar namespace."),(0,r.yg)("p",null,"The followings are some examples."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nimport org.apache.pulsar.client.api.Consumer;\nimport org.apache.pulsar.client.api.PulsarClient;\n\nimport java.util.Arrays;\nimport java.util.List;\nimport java.util.regex.Pattern;\n\nConsumerBuilder consumerBuilder = pulsarClient.newConsumer()\n        .subscriptionName(subscription);\n\n// Subscribe to all topics in a namespace\nPattern allTopicsInNamespace = Pattern.compile("public/default/.*");\nConsumer allTopicsConsumer = consumerBuilder\n        .topicsPattern(allTopicsInNamespace)\n        .subscribe();\n\n// Subscribe to a subsets of topics in a namespace, based on regex\nPattern someTopicsInNamespace = Pattern.compile("public/default/foo.*");\nConsumer allTopicsConsumer = consumerBuilder\n        .topicsPattern(someTopicsInNamespace)\n        .subscribe();\n\n')),(0,r.yg)("p",null,"In the above example, the consumer subscribes to the ",(0,r.yg)("inlineCode",{parentName:"p"},"persistent")," topics that can match the topic name pattern. If you want the consumer subscribes to all ",(0,r.yg)("inlineCode",{parentName:"p"},"persistent")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"non-persistent")," topics that can match the topic name pattern, set ",(0,r.yg)("inlineCode",{parentName:"p"},"subscriptionTopicsMode")," to ",(0,r.yg)("inlineCode",{parentName:"p"},"RegexSubscriptionMode.AllTopics"),"."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nPattern pattern = Pattern.compile("public/default/.*");\npulsarClient.newConsumer()\n        .subscriptionName("my-sub")\n        .topicsPattern(pattern)\n        .subscriptionTopicsMode(RegexSubscriptionMode.AllTopics)\n        .subscribe();\n\n')),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"By default, the ",(0,r.yg)("inlineCode",{parentName:"p"},"subscriptionTopicsMode")," of the consumer is ",(0,r.yg)("inlineCode",{parentName:"p"},"PersistentOnly"),". Available options of ",(0,r.yg)("inlineCode",{parentName:"p"},"subscriptionTopicsMode")," are ",(0,r.yg)("inlineCode",{parentName:"p"},"PersistentOnly"),", ",(0,r.yg)("inlineCode",{parentName:"p"},"NonPersistentOnly"),", and ",(0,r.yg)("inlineCode",{parentName:"p"},"AllTopics"),".")),(0,r.yg)("p",null,"You can also subscribe to an explicit list of topics (across namespaces if you wish):"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nList<String> topics = Arrays.asList(\n        "topic-1",\n        "topic-2",\n        "topic-3"\n);\n\nConsumer multiTopicConsumer = consumerBuilder\n        .topics(topics)\n        .subscribe();\n\n// Alternatively:\nConsumer multiTopicConsumer = consumerBuilder\n        .topic(\n            "topic-1",\n            "topic-2",\n            "topic-3"\n        )\n        .subscribe();\n\n')),(0,r.yg)("p",null,"You can also subscribe to multiple topics asynchronously using the ",(0,r.yg)("inlineCode",{parentName:"p"},"subscribeAsync")," method rather than the synchronous ",(0,r.yg)("inlineCode",{parentName:"p"},"subscribe")," method. The following is an example."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nPattern allTopicsInNamespace = Pattern.compile("persistent://public/default.*");\nconsumerBuilder\n        .topics(topics)\n        .subscribeAsync()\n        .thenAccept(this::receiveMessageFromConsumer);\n\nprivate void receiveMessageFromConsumer(Object consumer) {\n    ((Consumer)consumer).receiveAsync().thenAccept(message -> {\n                // Do something with the received message\n                receiveMessageFromConsumer(consumer);\n            });\n}\n\n')),(0,r.yg)("h3",{id:"subscription-types"},"Subscription types"),(0,r.yg)("p",null,"Pulsar has various ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/concepts-messaging#subscription-types"},"subscription types")," to match different scenarios. A topic can have multiple subscriptions with different subscription types. However, a subscription can only have one subscription type at a time."),(0,r.yg)("p",null,"A subscription is identical to the subscription name; a subscription name can specify only one subscription type at a time. To change the subscription type, you should first stop all consumers of this subscription."),(0,r.yg)("p",null,"Different subscription types have different message distribution types. This section describes the differences of subscription types and how to use them."),(0,r.yg)("p",null,'In order to better describe their differences, assume you have a topic named "my-topic", and the producer has published 10 messages.'),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nProducer<String> producer = client.newProducer(Schema.STRING)\n        .topic("my-topic")\n        .enableBatching(false)\n        .create();\n// 3 messages with "key-1", 3 messages with "key-2", 2 messages with "key-3" and 2 messages with "key-4"\nproducer.newMessage().key("key-1").value("message-1-1").send();\nproducer.newMessage().key("key-1").value("message-1-2").send();\nproducer.newMessage().key("key-1").value("message-1-3").send();\nproducer.newMessage().key("key-2").value("message-2-1").send();\nproducer.newMessage().key("key-2").value("message-2-2").send();\nproducer.newMessage().key("key-2").value("message-2-3").send();\nproducer.newMessage().key("key-3").value("message-3-1").send();\nproducer.newMessage().key("key-3").value("message-3-2").send();\nproducer.newMessage().key("key-4").value("message-4-1").send();\nproducer.newMessage().key("key-4").value("message-4-2").send();\n\n')),(0,r.yg)("h4",{id:"exclusive"},"Exclusive"),(0,r.yg)("p",null,"Create a new consumer and subscribe with the ",(0,r.yg)("inlineCode",{parentName:"p"},"Exclusive")," subscription type."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nConsumer consumer = client.newConsumer()\n        .topic("my-topic")\n        .subscriptionName("my-subscription")\n        .subscriptionType(SubscriptionType.Exclusive)\n        .subscribe()\n\n')),(0,r.yg)("p",null,"Only the first consumer is allowed to the subscription, other consumers receive an error. The first consumer receives all 10 messages, and the consuming order is the same as the producing order."),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"If topic is a partitioned topic, the first consumer subscribes to all partitioned topics, other consumers are not assigned with partitions and receive an error.")),(0,r.yg)("h4",{id:"failover"},"Failover"),(0,r.yg)("p",null,"Create new consumers and subscribe with the",(0,r.yg)("inlineCode",{parentName:"p"},"Failover")," subscription type."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nConsumer consumer1 = client.newConsumer()\n        .topic("my-topic")\n        .subscriptionName("my-subscription")\n        .subscriptionType(SubscriptionType.Failover)\n        .subscribe()\nConsumer consumer2 = client.newConsumer()\n        .topic("my-topic")\n        .subscriptionName("my-subscription")\n        .subscriptionType(SubscriptionType.Failover)\n        .subscribe()\n//conumser1 is the active consumer, consumer2 is the standby consumer.\n//consumer1 receives 5 messages and then crashes, consumer2 takes over as an  active consumer.\n\n')),(0,r.yg)("p",null,"Multiple consumers can attach to the same subscription, yet only the first consumer is active, and others are standby. When the active consumer is disconnected, messages will be dispatched to one of standby consumers, and the standby consumer then becomes active consumer."),(0,r.yg)("p",null,"If the first active consumer is disconnected after receiving 5 messages, the standby consumer becomes active consumer. Consumer1 will receive:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},'\n("key-1", "message-1-1")\n("key-1", "message-1-2")\n("key-1", "message-1-3")\n("key-2", "message-2-1")\n("key-2", "message-2-2")\n\n')),(0,r.yg)("p",null,"consumer2 will receive:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},'\n("key-2", "message-2-3")\n("key-3", "message-3-1")\n("key-3", "message-3-2")\n("key-4", "message-4-1")\n("key-4", "message-4-2")\n\n')),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"If a topic is a partitioned topic, each partition has only one active consumer, messages of one partition are distributed to only one consumer, and messages of multiple partitions are distributed to multiple consumers.")),(0,r.yg)("h4",{id:"shared"},"Shared"),(0,r.yg)("p",null,"Create new consumers and subscribe with ",(0,r.yg)("inlineCode",{parentName:"p"},"Shared")," subscription type."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nConsumer consumer1 = client.newConsumer()\n        .topic("my-topic")\n        .subscriptionName("my-subscription")\n        .subscriptionType(SubscriptionType.Shared)\n        .subscribe()\n\nConsumer consumer2 = client.newConsumer()\n        .topic("my-topic")\n        .subscriptionName("my-subscription")\n        .subscriptionType(SubscriptionType.Shared)\n        .subscribe()\n//Both consumer1 and consumer2 are active consumers.\n\n')),(0,r.yg)("p",null,"In Shared subscription type, multiple consumers can attach to the same subscription and messages are delivered in a round robin distribution across consumers."),(0,r.yg)("p",null,"If a broker dispatches only one message at a time, consumer1 receives the following information."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},'\n("key-1", "message-1-1")\n("key-1", "message-1-3")\n("key-2", "message-2-2")\n("key-3", "message-3-1")\n("key-4", "message-4-1")\n\n')),(0,r.yg)("p",null,"consumer2 receives the following information."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},'\n("key-1", "message-1-2")\n("key-2", "message-2-1")\n("key-2", "message-2-3")\n("key-3", "message-3-2")\n("key-4", "message-4-2")\n\n')),(0,r.yg)("p",null,(0,r.yg)("inlineCode",{parentName:"p"},"Shared")," subscription is different from ",(0,r.yg)("inlineCode",{parentName:"p"},"Exclusive")," and ",(0,r.yg)("inlineCode",{parentName:"p"},"Failover")," subscription types. ",(0,r.yg)("inlineCode",{parentName:"p"},"Shared")," subscription has better flexibility, but cannot provide order guarantee."),(0,r.yg)("h4",{id:"key_shared"},"Key_shared"),(0,r.yg)("p",null,"This is a new subscription type since 2.4.0 release. Create new consumers and subscribe with ",(0,r.yg)("inlineCode",{parentName:"p"},"Key_Shared")," subscription type."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nConsumer consumer1 = client.newConsumer()\n        .topic("my-topic")\n        .subscriptionName("my-subscription")\n        .subscriptionType(SubscriptionType.Key_Shared)\n        .subscribe()\n\nConsumer consumer2 = client.newConsumer()\n        .topic("my-topic")\n        .subscriptionName("my-subscription")\n        .subscriptionType(SubscriptionType.Key_Shared)\n        .subscribe()\n//Both consumer1 and consumer2 are active consumers.\n\n')),(0,r.yg)("p",null,"Just like in ",(0,r.yg)("inlineCode",{parentName:"p"},"Shared")," subscription, all consumers in ",(0,r.yg)("inlineCode",{parentName:"p"},"Key_Shared")," subscription type can attach to the same subscription. But ",(0,r.yg)("inlineCode",{parentName:"p"},"Key_Shared")," subscription type is different from the ",(0,r.yg)("inlineCode",{parentName:"p"},"Shared")," subscription. In ",(0,r.yg)("inlineCode",{parentName:"p"},"Key_Shared")," subscription type, messages with the same key are delivered to only one consumer in order. The possible distribution of messages between different consumers (by default we do not know in advance which keys will be assigned to a consumer, but a key will only be assigned to a consumer at the same time)."),(0,r.yg)("p",null,"consumer1 receives the following information."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},'\n("key-1", "message-1-1")\n("key-1", "message-1-2")\n("key-1", "message-1-3")\n("key-3", "message-3-1")\n("key-3", "message-3-2")\n\n')),(0,r.yg)("p",null,"consumer2 receives the following information."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},'\n("key-2", "message-2-1")\n("key-2", "message-2-2")\n("key-2", "message-2-3")\n("key-4", "message-4-1")\n("key-4", "message-4-2")\n\n')),(0,r.yg)("p",null,"If batching is enabled at the producer side, messages with different keys are added to a batch by default. The broker will dispatch the batch to the consumer, so the default batch mechanism may break the Key_Shared subscription guaranteed message distribution semantics. The producer needs to use the ",(0,r.yg)("inlineCode",{parentName:"p"},"KeyBasedBatcher"),"."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nProducer producer = client.newProducer()\n        .topic("my-topic")\n        .batcherBuilder(BatcherBuilder.KEY_BASED)\n        .create();\n\n')),(0,r.yg)("p",null,"Or the producer can disable batching."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nProducer producer = client.newProducer()\n        .topic("my-topic")\n        .enableBatching(false)\n        .create();\n\n')),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"If the message key is not specified, messages without keys are dispatched to one consumer in order by default.")),(0,r.yg)("h3",{id:"intercept-messages-1"},"Intercept messages"),(0,r.yg)("p",null,(0,r.yg)("inlineCode",{parentName:"p"},"ConsumerInterceptor"),"s intercept and possibly mutate messages received by the consumer."),(0,r.yg)("p",null,"The interface has six main events:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"beforeConsume")," is triggered before the message is returned by ",(0,r.yg)("inlineCode",{parentName:"li"},"receive()")," or ",(0,r.yg)("inlineCode",{parentName:"li"},"receiveAsync()"),". You can modify messages within this event."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"onAcknowledge")," is triggered before the consumer sends the acknowledgement to the broker."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"onAcknowledgeCumulative")," is triggered before the consumer sends the cumulative acknowledgement to the broker."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"onNegativeAcksSend")," is triggered when a redelivery from a negative acknowledgement occurs."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"onAckTimeoutSend")," is triggered when a redelivery from an acknowledgement timeout occurs."),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"onPartitionsChange")," is triggered when the partitions of the (partitioned) topic change.")),(0,r.yg)("p",null,"To intercept messages, you can add one or multiple ",(0,r.yg)("inlineCode",{parentName:"p"},"ConsumerInterceptor"),"s when creating a ",(0,r.yg)("inlineCode",{parentName:"p"},"Consumer")," as follows."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nConsumer<String> consumer = client.newConsumer()\n        .topic("my-topic")\n        .subscriptionName("my-subscription")\n        .intercept(new ConsumerInterceptor<String> {\n              @Override\n              public Message<String> beforeConsume(Consumer<String> consumer, Message<String> message) {\n                  // user-defined processing logic\n              }\n\n              @Override\n              public void onAcknowledge(Consumer<String> consumer, MessageId messageId, Throwable cause) {\n                  // user-defined processing logic\n              }\n\n              @Override\n              public void onAcknowledgeCumulative(Consumer<String> consumer, MessageId messageId, Throwable cause) {\n                  // user-defined processing logic\n              }\n\n              @Override\n              public void onNegativeAcksSend(Consumer<String> consumer, Set<MessageId> messageIds) {\n                  // user-defined processing logic\n              }\n\n              @Override\n              public void onAckTimeoutSend(Consumer<String> consumer, Set<MessageId> messageIds) {\n                  // user-defined processing logic\n              }\n\n              @Override\n              public void onPartitionsChange(String topicName, int partitions) {\n                  // user-defined processing logic\n              }\n        })\n        .subscribe();\n\n')),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"If you are using multiple interceptors, they apply in the order they are passed to the ",(0,r.yg)("inlineCode",{parentName:"p"},"intercept")," method.")),(0,r.yg)("h2",{id:"reader"},"Reader"),(0,r.yg)("p",null,"With the ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/concepts-clients#reader-interface"},"reader interface"),', Pulsar clients can "manually position" themselves within a topic and read all messages from a specified message onward. The Pulsar API for Java enables you to create ',(0,r.yg)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/2.10.x/org/apache/pulsar/client/api/Reader"},"Reader")," objects by specifying a topic and a ",(0,r.yg)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/2.10.x/org/apache/pulsar/client/api/MessageId"},"MessageId"),"."),(0,r.yg)("p",null,"The following is an example."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},"\nbyte[] msgIdBytes = // Some message ID byte array\nMessageId id = MessageId.fromByteArray(msgIdBytes);\nReader reader = pulsarClient.newReader()\n        .topic(topic)\n        .startMessageId(id)\n        .create();\n\nwhile (true) {\n    Message message = reader.readNext();\n    // Process message\n}\n\n")),(0,r.yg)("p",null,"In the example above, a ",(0,r.yg)("inlineCode",{parentName:"p"},"Reader")," object is instantiated for a specific topic and message (by ID); the reader iterates over each message in the topic after the message is identified by ",(0,r.yg)("inlineCode",{parentName:"p"},"msgIdBytes")," (how that value is obtained depends on the application)."),(0,r.yg)("p",null,"The code sample above shows pointing the ",(0,r.yg)("inlineCode",{parentName:"p"},"Reader")," object to a specific message (by ID), but you can also use ",(0,r.yg)("inlineCode",{parentName:"p"},"MessageId.earliest")," to point to the earliest available message on the topic of ",(0,r.yg)("inlineCode",{parentName:"p"},"MessageId.latest")," to point to the most recent available message."),(0,r.yg)("h3",{id:"configure-reader"},"Configure reader"),(0,r.yg)("p",null,"When you create a reader, you can use the ",(0,r.yg)("inlineCode",{parentName:"p"},"loadConf")," configuration. The following parameters are available in ",(0,r.yg)("inlineCode",{parentName:"p"},"loadConf"),"."),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Name"),(0,r.yg)("th",{parentName:"tr",align:null},"Type"),(0,r.yg)("th",{parentName:"tr",align:null},(0,r.yg)("div",null,"Description")),(0,r.yg)("th",{parentName:"tr",align:null},"Default"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"topicName")),(0,r.yg)("td",{parentName:"tr",align:null},"String"),(0,r.yg)("td",{parentName:"tr",align:null},"Topic name."),(0,r.yg)("td",{parentName:"tr",align:null},"None")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"receiverQueueSize")),(0,r.yg)("td",{parentName:"tr",align:null},"int"),(0,r.yg)("td",{parentName:"tr",align:null},"Size of a consumer's receiver queue.",(0,r.yg)("br",null),(0,r.yg)("br",null),"For example, the number of messages that can be accumulated by a consumer before an application calls ",(0,r.yg)("inlineCode",{parentName:"td"},"Receive"),".",(0,r.yg)("br",null),(0,r.yg)("br",null),"A value higher than the default value increases consumer throughput, though at the expense of more memory utilization."),(0,r.yg)("td",{parentName:"tr",align:null},"1000")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"readerListener")),(0,r.yg)("td",{parentName:"tr",align:null},"ReaderListener","<","T",">"),(0,r.yg)("td",{parentName:"tr",align:null},"A listener that is called for message received."),(0,r.yg)("td",{parentName:"tr",align:null},"None")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"readerName")),(0,r.yg)("td",{parentName:"tr",align:null},"String"),(0,r.yg)("td",{parentName:"tr",align:null},"Reader name."),(0,r.yg)("td",{parentName:"tr",align:null},"null")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"subscriptionName")),(0,r.yg)("td",{parentName:"tr",align:null},"String"),(0,r.yg)("td",{parentName:"tr",align:null},"Subscription name"),(0,r.yg)("td",{parentName:"tr",align:null},"When there is a single topic, the default subscription name is ",(0,r.yg)("inlineCode",{parentName:"td"},'"reader-" + 10-digit UUID'),".",(0,r.yg)("br",null),"When there are multiple topics, the default subscription name is ",(0,r.yg)("inlineCode",{parentName:"td"},'"multiTopicsReader-" + 10-digit UUID'),".")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"subscriptionRolePrefix")),(0,r.yg)("td",{parentName:"tr",align:null},"String"),(0,r.yg)("td",{parentName:"tr",align:null},"Prefix of subscription role."),(0,r.yg)("td",{parentName:"tr",align:null},"null")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"cryptoKeyReader")),(0,r.yg)("td",{parentName:"tr",align:null},"CryptoKeyReader"),(0,r.yg)("td",{parentName:"tr",align:null},"Interface that abstracts the access to a key store."),(0,r.yg)("td",{parentName:"tr",align:null},"null")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"cryptoFailureAction")),(0,r.yg)("td",{parentName:"tr",align:null},"ConsumerCryptoFailureAction"),(0,r.yg)("td",{parentName:"tr",align:null},"Consumer should take action when it receives a message that can not be decrypted.",(0,r.yg)("br",null),(0,r.yg)("li",null,(0,r.yg)("strong",{parentName:"td"},"FAIL"),": this is the default option to fail messages until crypto succeeds."),(0,r.yg)("li",null," ",(0,r.yg)("strong",{parentName:"td"},"DISCARD"),": silently acknowledge and not deliver message to an application."),(0,r.yg)("li",null,(0,r.yg)("strong",{parentName:"td"},"CONSUME"),": deliver encrypted messages to applications. It is the application's responsibility to decrypt the message."),(0,r.yg)("br",null),"The message decompression fails. ",(0,r.yg)("br",null),(0,r.yg)("br",null),"If messages contain batch messages, a client is not be able to retrieve individual messages in batch.",(0,r.yg)("br",null),(0,r.yg)("br",null),"Delivered encrypted message contains {@link EncryptionContext} which contains encryption and compression information in it using which application can decrypt consumed message payload."),(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("li",null,"ConsumerCryptoFailureAction.FAIL"))),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"readCompacted")),(0,r.yg)("td",{parentName:"tr",align:null},"boolean"),(0,r.yg)("td",{parentName:"tr",align:null},"If enabling ",(0,r.yg)("inlineCode",{parentName:"td"},"readCompacted"),", a consumer reads messages from a compacted topic rather than a full message backlog of a topic.",(0,r.yg)("br",null),(0,r.yg)("br",null)," A consumer only sees the latest value for each key in the compacted topic, up until reaching the point in the topic message when compacting backlog. Beyond that point, send messages as normal.",(0,r.yg)("br",null),(0,r.yg)("br",null),(0,r.yg)("inlineCode",{parentName:"td"},"readCompacted")," can only be enabled on subscriptions to persistent topics, which have a single active consumer (for example, failure or exclusive subscriptions). ",(0,r.yg)("br",null),(0,r.yg)("br",null),"Attempting to enable it on subscriptions to non-persistent topics or on shared subscriptions leads to a subscription call throwing a ",(0,r.yg)("inlineCode",{parentName:"td"},"PulsarClientException"),"."),(0,r.yg)("td",{parentName:"tr",align:null},"false")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"resetIncludeHead")),(0,r.yg)("td",{parentName:"tr",align:null},"boolean"),(0,r.yg)("td",{parentName:"tr",align:null},"If set to true, the first message to be returned is the one specified by ",(0,r.yg)("inlineCode",{parentName:"td"},"messageId"),".",(0,r.yg)("br",null),(0,r.yg)("br",null),"If set to false, the first message to be returned is the one next to the message specified by ",(0,r.yg)("inlineCode",{parentName:"td"},"messageId"),"."),(0,r.yg)("td",{parentName:"tr",align:null},"false")))),(0,r.yg)("h3",{id:"sticky-key-range-reader"},"Sticky key range reader"),(0,r.yg)("p",null,"In sticky key range reader, broker will only dispatch messages which hash of the message key contains by the specified key hash range. Multiple key hash ranges can be specified on a reader."),(0,r.yg)("p",null,"The following is an example to create a sticky key range reader."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},"\npulsarClient.newReader()\n        .topic(topic)\n        .startMessageId(MessageId.earliest)\n        .keyHashRange(Range.of(0, 10000), Range.of(20001, 30000))\n        .create();\n\n")),(0,r.yg)("p",null,"Total hash range size is 65536, so the max end of the range should be less than or equal to 65535."),(0,r.yg)("h2",{id:"tableview"},"TableView"),(0,r.yg)("p",null,"The TableView interface serves an encapsulated access pattern, providing a continuously updated key-value map view of the compacted topic data. Messages without keys will be ignored."),(0,r.yg)("p",null,"With TableView, Pulsar clients can fetch all the message updates from a topic and construct a map with the latest values of each key. These values can then be used to build a local cache of data. In addition, you can register consumers with the TableView by specifying a listener to perform a scan of the map and then receive notifications when new messages are received. Consequently, event handling can be triggered to serve use cases, such as event-driven applications and message monitoring."),(0,r.yg)("admonition",{type:"note"},(0,r.yg)("p",{parentName:"admonition"},"Each TableView uses one Reader instance per partition, and reads the topic starting from the compacted view by default. It is highly recommended to enable automatic compaction by ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/cookbooks-compaction#configure-compaction-to-run-automatically"},"configuring the topic compaction policies")," for the given topic or namespace. More frequent compaction results in shorter startup times because less data is replayed to reconstruct the TableView of the topic.")),(0,r.yg)("p",null,"The following figure illustrates the dynamic construction of a TableView updated with newer values of each key.\n",(0,r.yg)("img",{alt:"TableView",src:t(51716).A,width:"3323",height:"1742"})),(0,r.yg)("h3",{id:"configure-tableview"},"Configure TableView"),(0,r.yg)("p",null,"The following is an example of how to configure a TableView."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nTableView<String> tv = client.newTableViewBuilder(Schema.STRING)\n  .topic("my-tableview")\n  .create()\n\n')),(0,r.yg)("p",null,"You can use the available parameters in the ",(0,r.yg)("inlineCode",{parentName:"p"},"loadConf")," configuration or related ",(0,r.yg)("a",{parentName:"p",href:"https://pulsar.apache.org/api/client/2.10.x/2.10.0-SNAPSHOT/org/apache/pulsar/client/api/TableViewBuilder.html"},"API")," to customize your TableView."),(0,r.yg)("table",null,(0,r.yg)("thead",{parentName:"table"},(0,r.yg)("tr",{parentName:"thead"},(0,r.yg)("th",{parentName:"tr",align:null},"Name"),(0,r.yg)("th",{parentName:"tr",align:null},"Type"),(0,r.yg)("th",{parentName:"tr",align:null},"Required?"),(0,r.yg)("th",{parentName:"tr",align:null},(0,r.yg)("div",null,"Description")),(0,r.yg)("th",{parentName:"tr",align:null},"Default"))),(0,r.yg)("tbody",{parentName:"table"},(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"topic")),(0,r.yg)("td",{parentName:"tr",align:null},"string"),(0,r.yg)("td",{parentName:"tr",align:null},"yes"),(0,r.yg)("td",{parentName:"tr",align:null},"The topic name of the TableView."),(0,r.yg)("td",{parentName:"tr",align:null},"N/A")),(0,r.yg)("tr",{parentName:"tbody"},(0,r.yg)("td",{parentName:"tr",align:null},(0,r.yg)("inlineCode",{parentName:"td"},"autoUpdatePartitionInterval")),(0,r.yg)("td",{parentName:"tr",align:null},"int"),(0,r.yg)("td",{parentName:"tr",align:null},"no"),(0,r.yg)("td",{parentName:"tr",align:null},"The interval to check for newly added partitions."),(0,r.yg)("td",{parentName:"tr",align:null},"60 (seconds)")))),(0,r.yg)("h3",{id:"register-listeners"},"Register listeners"),(0,r.yg)("p",null,"You can register listeners for both existing messages on a topic and new messages coming into the topic by using ",(0,r.yg)("inlineCode",{parentName:"p"},"forEachAndListen"),", and specify to perform operations for all existing messages by using ",(0,r.yg)("inlineCode",{parentName:"p"},"forEach"),"."),(0,r.yg)("p",null,"The following is an example of how to register listeners with TableView."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},"\n// Register listeners for all existing and incoming messages\ntv.forEachAndListen((key, value) -> /*operations on all existing and incoming messages*/)\n\n// Register action for all existing messages\ntv.forEach((key, value) -> /*operations on all existing messages*/)\n\n")),(0,r.yg)("h2",{id:"schema"},"Schema"),(0,r.yg)("p",null,'In Pulsar, all message data consists of byte arrays "under the hood." ',(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/schema-get-started"},"Message schemas")," enable you to use other types of data when constructing and handling messages (from simple types like strings to more complex, application-specific types). If you construct, say, a ",(0,r.yg)("a",{parentName:"p",href:"#producer"},"producer")," without specifying a schema, then the producer can only produce messages of type ",(0,r.yg)("inlineCode",{parentName:"p"},"byte[]"),". The following is an example."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},"\nProducer<byte[]> producer = client.newProducer()\n        .topic(topic)\n        .create();\n\n")),(0,r.yg)("p",null,"The producer above is equivalent to a ",(0,r.yg)("inlineCode",{parentName:"p"},"Producer<byte[]>")," (in fact, you should ",(0,r.yg)("em",{parentName:"p"},"always")," explicitly specify the type). If you'd like to use a producer for a different type of data, you'll need to specify a ",(0,r.yg)("strong",{parentName:"p"},"schema")," that informs Pulsar which data type will be transmitted over the ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/reference-terminology#topic"},"topic"),"."),(0,r.yg)("h3",{id:"avrobasestructschema-example"},"AvroBaseStructSchema example"),(0,r.yg)("p",null,"Let's say that you have a ",(0,r.yg)("inlineCode",{parentName:"p"},"SensorReading")," class that you'd like to transmit over a Pulsar topic:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},"\npublic class SensorReading {\n    public float temperature;\n\n    public SensorReading(float temperature) {\n        this.temperature = temperature;\n    }\n\n    // A no-arg constructor is required\n    public SensorReading() {\n    }\n\n    public float getTemperature() {\n        return temperature;\n    }\n\n    public void setTemperature(float temperature) {\n        this.temperature = temperature;\n    }\n}\n\n")),(0,r.yg)("p",null,"You could then create a ",(0,r.yg)("inlineCode",{parentName:"p"},"Producer<SensorReading>")," (or ",(0,r.yg)("inlineCode",{parentName:"p"},"Consumer<SensorReading>"),") like this:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nProducer<SensorReading> producer = client.newProducer(JSONSchema.of(SensorReading.class))\n        .topic("sensor-readings")\n        .create();\n\n')),(0,r.yg)("p",null,"The following schema formats are currently available for Java:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"No schema or the byte array schema (which can be applied using ",(0,r.yg)("inlineCode",{parentName:"p"},"Schema.BYTES"),"):"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nProducer<byte[]> bytesProducer = client.newProducer(Schema.BYTES)\n    .topic("some-raw-bytes-topic")\n    .create();\n\n')),(0,r.yg)("p",{parentName:"li"},"Or, equivalently:"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nProducer<byte[]> bytesProducer = client.newProducer()\n    .topic("some-raw-bytes-topic")\n    .create();\n\n'))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},(0,r.yg)("inlineCode",{parentName:"p"},"String")," for normal UTF-8-encoded string data. Apply the schema using ",(0,r.yg)("inlineCode",{parentName:"p"},"Schema.STRING"),":"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nProducer<String> stringProducer = client.newProducer(Schema.STRING)\n    .topic("some-string-topic")\n    .create();\n\n'))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Create JSON schemas for POJOs using ",(0,r.yg)("inlineCode",{parentName:"p"},"Schema.JSON"),". The following is an example."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nProducer<MyPojo> pojoProducer = client.newProducer(Schema.JSON(MyPojo.class))\n    .topic("some-pojo-topic")\n    .create();\n\n'))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Generate Protobuf schemas using ",(0,r.yg)("inlineCode",{parentName:"p"},"Schema.PROTOBUF"),". The following example shows how to create the Protobuf schema and use it to instantiate a new producer:"),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nProducer<MyProtobuf> protobufProducer = client.newProducer(Schema.PROTOBUF(MyProtobuf.class))\n    .topic("some-protobuf-topic")\n    .create();\n\n'))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"Define Avro schemas with ",(0,r.yg)("inlineCode",{parentName:"p"},"Schema.AVRO"),". The following code snippet demonstrates how to create and use Avro schema."),(0,r.yg)("pre",{parentName:"li"},(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nProducer<MyAvro> avroProducer = client.newProducer(Schema.AVRO(MyAvro.class))\n    .topic("some-avro-topic")\n    .create();\n\n')))),(0,r.yg)("h3",{id:"protobufnativeschema-example"},"ProtobufNativeSchema example"),(0,r.yg)("p",null,"For example of ProtobufNativeSchema, see ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/schema-understand#complex-type"},(0,r.yg)("inlineCode",{parentName:"a"},"SchemaDefinition")," in ",(0,r.yg)("inlineCode",{parentName:"a"},"Complex type")),"."),(0,r.yg)("h2",{id:"authentication"},"Authentication"),(0,r.yg)("p",null,"Pulsar currently supports multiple authentication schemes: ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/security-tls-authentication"},"TLS"),", ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/security-athenz"},"Athenz"),", ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/security-kerberos"},"Kerberos"),", and ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/security-jwt"},"JSON Web Token (JWT)"),". You can use the Pulsar Java client with all of them."),(0,r.yg)("h3",{id:"tls-authentication"},"TLS Authentication"),(0,r.yg)("p",null,"To use ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/security-tls-authentication"},"TLS"),", ",(0,r.yg)("inlineCode",{parentName:"p"},"enableTls"),' method is deprecated and you need to use "pulsar+ssl://" in serviceUrl to enable, point your Pulsar client to a TLS cert path, and provide paths to cert and key files.'),(0,r.yg)("p",null,"The following is an example."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nMap<String, String> authParams = new HashMap();\nauthParams.put("tlsCertFile", "/path/to/client-cert.pem");\nauthParams.put("tlsKeyFile", "/path/to/client-key.pem");\n\nAuthentication tlsAuth = AuthenticationFactory\n        .create(AuthenticationTls.class.getName(), authParams);\n\nPulsarClient client = PulsarClient.builder()\n        .serviceUrl("pulsar+ssl://my-broker.com:6651")\n        .tlsTrustCertsFilePath("/path/to/cacert.pem")\n        .authentication(tlsAuth)\n        .build();\n\n')),(0,r.yg)("h3",{id:"athenz"},"Athenz"),(0,r.yg)("p",null,"To use ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/security-athenz"},"Athenz")," as an authentication provider, you need to ",(0,r.yg)("a",{parentName:"p",href:"#tls-authentication"},"use TLS")," and provide values for four parameters in a hash:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"tenantDomain")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"tenantService")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"providerDomain")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"privateKey"))),(0,r.yg)("p",null,"You can also set an optional ",(0,r.yg)("inlineCode",{parentName:"p"},"keyId"),". The following is an example."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nMap<String, String> authParams = new HashMap();\nauthParams.put("tenantDomain", "shopping"); // Tenant domain name\nauthParams.put("tenantService", "some_app"); // Tenant service name\nauthParams.put("providerDomain", "pulsar"); // Provider domain name\nauthParams.put("privateKey", "file:///path/to/private.pem"); // Tenant private key path\nauthParams.put("keyId", "v1"); // Key id for the tenant private key (optional, default: "0")\n\nAuthentication athenzAuth = AuthenticationFactory\n        .create(AuthenticationAthenz.class.getName(), authParams);\n\nPulsarClient client = PulsarClient.builder()\n        .serviceUrl("pulsar+ssl://my-broker.com:6651")\n        .tlsTrustCertsFilePath("/path/to/cacert.pem")\n        .authentication(athenzAuth)\n        .build();\n\n')),(0,r.yg)("blockquote",null,(0,r.yg)("h4",{parentName:"blockquote",id:"supported-pattern-formats"},"Supported pattern formats"),(0,r.yg)("p",{parentName:"blockquote"},"The ",(0,r.yg)("inlineCode",{parentName:"p"},"privateKey")," parameter supports the following three pattern formats:"),(0,r.yg)("ul",{parentName:"blockquote"},(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"file:///path/to/file")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"file:/path/to/file")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"data:application/x-pem-file;base64,<base64-encoded value>")))),(0,r.yg)("h3",{id:"oauth2"},"Oauth2"),(0,r.yg)("p",null,"The following example shows how to use ",(0,r.yg)("a",{parentName:"p",href:"/docs/2.10.x/security-oauth2"},"Oauth2")," as an authentication provider for the Pulsar Java client."),(0,r.yg)("p",null,"You can use the factory method to configure authentication for Pulsar Java client."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nPulsarClient client = PulsarClient.builder()\n    .serviceUrl("pulsar://broker.example.com:6650/")\n    .authentication(\n        AuthenticationFactoryOAuth2.clientCredentials(this.issuerUrl, this.credentialsUrl, this.audience))\n    .build();\n\n')),(0,r.yg)("p",null,"In addition, you can also use the encoded parameters to configure authentication for Pulsar Java client."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-java"},'\nAuthentication auth = AuthenticationFactory\n    .create(AuthenticationOAuth2.class.getName(), "{"type":"client_credentials","privateKey":"...","issuerUrl":"...","audience":"..."}");\nPulsarClient client = PulsarClient.builder()\n    .serviceUrl("pulsar://broker.example.com:6650/")\n    .authentication(auth)\n    .build();\n\n')))}d.isMDXComponent=!0},79635:(e,a,t)=>{t.d(a,{A:()=>n});const n=t.p+"assets/images/cluster-level-failover-1-88ca78e0ce3742e8dff1fb1c65abcadc.png"},84024:(e,a,t)=>{t.d(a,{A:()=>n});const n=t.p+"assets/images/cluster-level-failover-2-47d28c1809d4fc140d3846f09aaa6670.png"},5153:(e,a,t)=>{t.d(a,{A:()=>n});const n=t.p+"assets/images/cluster-level-failover-3-e4c1f0e86f1652f300f2bc54d342b955.png"},6670:(e,a,t)=>{t.d(a,{A:()=>n});const n=t.p+"assets/images/cluster-level-failover-4-c999ee966e8755f6c7ad88d0194e839f.png"},6167:(e,a,t)=>{t.d(a,{A:()=>n});const n=t.p+"assets/images/cluster-level-failover-5-0a93e8702482ebd19c10a1fd8954997d.png"},51716:(e,a,t)=>{t.d(a,{A:()=>n});const n=t.p+"assets/images/tableview-a5bea774c5591395d61725e720ebf908.png"}}]);